* macd
[[http://wiki.mbalib.com/wiki/%25E5%25B9%25B3%25E6%25BB%2591%25E5%25BC%2582%25E5%2590%258C%25E7%25A7%25BB%25E5%258A%25A8%25E5%25B9%25B3%25E5%259D%2587%25E7%25BA%25BF][平滑异同移动平均线]]
MACD 对技术流投资者的重要性不言而喻。然而，很多资料对其详细算法都语焉不详。尤其是第一天和第二天的 MACD 的处理方式，很多说法有差别。今天查了查资料，终于搞清楚了其计算方法。用该方法计算理工检测，法因数控等股票 MACD，和大智慧或者飞狐交易师上面显示的 DIFF,DEA 以及 MACD 完全吻合。
关键的一点是：新股上市首日，其 DIFF,DEA 以及 MACD 都为 0，因为当日不存在前一日，无法做迭代。而计算新股上市第二日的 EMA 时，前一日的 EMA 需要用收盘价（而非 0）来计算。另外，需要注意，计算过程小数点后四舍五入保留 4 位小数，最后显示的时候四舍五入保留 3 位小数。

具体计算公式及例子如下： 

EMA（12）= 前一日 EMA（12）×11/13＋今日收盘价×2/13
EMA（26）= 前一日 EMA（26）×25/27＋今日收盘价×2/27
DIFF=今日 EMA（12）- 今日 EMA（26）
DEA（MACD）= 前一日 DEA×8/10＋今日 DIF×2/10 
BAR=2×(DIFF－DEA)

对理工检测：
20091218 日：
    新股上市，DIFF=0, DEA=0, MACD=0，收盘价 55.01
20091219 日：
    收盘价 53.7
    EMA（12）=55.01+(53.7-55.01)×2/13=54.8085   
    EMA（26）=55.01+(53.7-55.01)×2/27=54.913  
    DIFF=EMA（12）- EMA（26）= 54.8085 - 54.913 = -0.1045  （-0.104？）
    DEA=0+(-0.1045)X2/10=-0.0209
    BAR=2*((-0.1045)-(-0.0209))=-0.1672
对法因数控：
20080905 日：
    新股上市，DIFF=0, DEA=0, MACD=0，收盘价 12.34
20080908 日：
    收盘价 11.11
    EMA（12）=12.34+(11.11-12.34)×2/13=12.1508
    EMA（26）=12.34+(11.11-12.34)×2/27=12.2489
    DIFF=EMA（12）- EMA（26）= 12.1508 - 12.2489 = -0.0981
    DEA=0+(-0.0981)X2/10=-0.01962
    BAR=2*((-0.0981)-(-0.01962))=-0.15696

Python 运行效率确实不高，计算沪深两市 10 年来 MACD 日线金叉情况竟然需要运行 10 分钟，还是得换 Java 来。需要计算一下不同周期（日线，60 分钟线...）低位二次金叉买入，死叉卖出的盈利和亏损情况。
