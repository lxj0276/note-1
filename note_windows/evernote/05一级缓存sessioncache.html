<html>
<head>
  <title>05一级缓存sessioncache</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="5390"/>
<h1>05一级缓存sessioncache</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/8/5 23:23</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/8/19 19:40</i></td></tr>
<tr><td><b>标签：</b></td><td><i>Hibernate, 一级缓存</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="file:///"><i>file:///</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><div align="justify"><font color="#010101" face="宋体">一级缓存提供了一个临时存放对象的一个内存结构，当</font><font color="#010101" face="Times New Roman">hibernate</font><font face="宋体"><font color="#010101">对</font><b style="background-color: rgb(255, 250, 165); font-size: 24px;"><font color="#2D4FC9">对象</font></b><font color="#010101">进行操作的时候，仅仅改变的是对象的属性，改变的是一级缓存中的对象的属性，在</font></font> <font color="#010101" face="Times New Roman">session.flush</font><font color="#010101" face="宋体">之前的代码可以任意写</font><span style="color: rgb(1, 1, 1); font-family: 宋体;">，</span><font color="#010101" face="宋体">因为这个时候，并没有和数据</font><font color="#010101" face="宋体">库交互。当执行</font> <font color="#010101" face="Times New Roman">session.flush</font><font color="#010101" face="宋体">的时候，</font><font color="#010101" face="Times New Roman">hibernate</font> <font color="#010101" face="宋体">会检查一级缓存中的对象的情况，发出</font> <font color="#010101" face="Times New Roman">insert</font><font color="#010101" face="宋体">或者</font><font color="#010101" face="Times New Roman">update</font> <font color="#010101" face="宋体">语句。</font></div><div align="justify"><font color="#010101" face="宋体">一级缓存中也包括集合的缓存</font></div><div><br/></div><div><div>图解该缓存的精华：</div><div><img src="05一级缓存sessioncache_files/Image.png" type="image/png" height="535" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1266"/></div><div><br/></div><div><br/></div>
关于save（insert) 和update 的区别
<div><br/></div><div>当为临时变量的时候，也就是new出来的，这个时候，没有id，通过save方法，可以把其放到cache中去，而不是立马放到数据库中。最后事务提交的时候，才会执行insert语句。</div><div>对于update方法，必须保证数据库（缓存）中，有该记录，才可以进行跟新。否则，会报错。他不是insert语句，只是负责修改。</div><div><hr/></div><div><br/></div><div><hr/></div><div>对于update方法</div><div><br/></div><div><img src="05一级缓存sessioncache_files/Image [1].png" type="image/png" height="326" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="605"/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><br/></div><div><br/></div>
关于save（insert) 和update 的区别
<div><br/></div><div>当为临时变量的时候，也就是new出来的，这个时候，没有id，通过save方法，可以把其放到cache中去，而不是立马放到数据库中。最后事务提交的时候，才会执行insert语句。</div><div>对于update方法，必须保证数据库（缓存）中，有该记录，才可以进行跟新。否则，会报错。他不是insert语句，只是负责修改。</div><div><hr/></div><div>对于get方法，首先会在缓存中找一个数据，如果没有，才会在数据库中找该该数据。</div><div><br/></div><div>图解如下：</div><div>缓存中，还有要get的数据：</div><div><br/></div><div><img src="05一级缓存sessioncache_files/Image [2].png" type="image/png" height="416" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1316"/></div><div><br/></div><div>缓存中，没有要get的记录，那么就去数据库中查找。</div><div><br/></div><div><img src="05一级缓存sessioncache_files/Image [3].png" type="image/png" height="541" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1194"/></div><div><br/></div><div><br/></div><div><hr/></div><div>对于update方法</div><div><br/></div><div><img src="05一级缓存sessioncache_files/Image [4].png" type="image/png" height="326" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="605"/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><img src="05一级缓存sessioncache_files/Image [5].png" type="image/png" style="cursor: default;"/><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>也就是说，以后不管是什么方法，都要经过持久化状态。update()、insert()、get()</div><div>save 首先是保存到sessioncache，</div><div>get 首先也是从sessioncache中获得。</div><hr/><span style="background-color: rgb(255, 250, 165); font-size: 32px;"><b><u>save方法，任何一个对象，其主键，都是由框架给的。因此，save方法，会把临时状态的对象，放到永久状态，也就是sessioncache缓存中。</u></b></span><div><img src="05一级缓存sessioncache_files/Image [6].png" type="image/png" height="347" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1298"/></div><div><br/></div><div><hr/><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;font-size: 64px;"><u><font color="#1AADE0">get方法同理：</font></u></span></div><div><img src="05一级缓存sessioncache_files/Image [7].png" type="image/png" style="cursor: default;"/></div><div><br/></div><div><hr/><div align="left" style="font-size: 32px;"><font face="微软雅黑"><i><u><b style="background-color: rgb(255, 250, 165);">注：update，是对数据库中更新数据，也就是说，只有数据库中存在的数据，才可以更新，不然，是不能更新的。</b></u></i></font></div></div><div><br/></div><div>但是，在hibernate的update的方法，我们可以new一个数据，我们要自己设置主键，并且主键应该是数据库中存在的主键，才可以update，这个执行的步骤是，先将临时状态的对象，放到缓存中去，然后，框架去执行该语句，如果给定的主键正确，那么就可以update成功，不然，就会失败的。</div><div><br/></div><div><img src="05一级缓存sessioncache_files/Image [8].png" type="image/png" height="447" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1223"/></div><hr/><div align="left"><font face="Consolas">evcit（对象），该方法，从缓存中，清除该对象。</font></div><div align="left"><font face="Consolas">代码不演示。</font></div><div align="left"><font face="Consolas"><br/></font></div><div align="left"><font face="Consolas"><br/></font></div><div align="left"><font face="Consolas"><br/></font></div><div align="left"><hr/><div>flush方法。</div><div><font color="#010101" face="宋体"><br/></font></div><div><img src="05一级缓存sessioncache_files/Image [9].png" type="image/png" height="517" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1312"/></div><hr/><div><font color="#010101">refresh（object obj）</font></div><div><font color="#010101" face="宋体">把数据库中的数据重新加载到缓存中</font></div><div><img src="05一级缓存sessioncache_files/Image [10].png" type="image/png" height="441" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1239"/></div><div><font color="#010101" face="宋体"><br/></font></div><div><font color="#010101" face="宋体"><br/></font></div><div><font color="#010101" face="宋体"><br/></font></div><div><hr/></div><div align="justify" style="font-size: 32px;"><span style="background-color: rgb(255, 250, 165);"><font color="#010101" face="Times New Roman"> </font> <u><font color="#010101" face="宋体">利用</font><font color="#010101" face="Times New Roman">update</font><font color="#010101">，</font><font color="#010101" face="Times New Roman">save</font><font color="#010101" face="宋体">，</font><font color="#010101" face="Times New Roman">get</font><font color="#010101" face="宋体">方法可以把对象放入到缓存中，这也再次验证，必须通过缓存。</font></u></span></div><p align="justify" style="margin: 4.57mm 0mm; text-indent: 0mm; line-height: 173%; font-size: 21px;"><font color="#010101" face="宋体">把数据从缓存中清除</font></p><div align="justify" style="font-size: 21px;"><font color="#010101" face="宋体">利用</font><font color="#010101" face="Times New Roman">evcit（object）</font>,<font color="#010101" face="Times New Roman">clear（）</font><font color="#010101" face="宋体">方法可以把对象从一级缓存中清空</font></div><p align="justify" style="margin: 4.57mm 0mm; text-indent: 0mm; line-height: 173%; font-size: 21px;"><font color="#010101" face="Times New Roman">flush（）</font><font color="#010101" face="宋体">方法 </font><span style="color: rgb(1, 1, 1);">把缓存中的对象同步到数据库中</span></p><p align="justify" style="margin: 4.57mm 0mm; text-indent: 0mm; line-height: 173%; font-size: 21px;"><font color="#010101" face="Times New Roman">refresh（object）</font><font color="#010101" face="宋体">方法</font><span style="color: rgb(1, 1, 1);">把数据库中的数据同步到缓存中。</span></p><hr/><p align="justify" style="margin: 4.57mm 0mm; text-indent: 0mm; line-height: 173%; font-size: 32px;"><font color="#010101" face="宋体" style="background-color: rgb(255, 250, 165);"><u>意义</u></font></p><div align="justify" style="font-size: 21px;"><font color="#010101" face="宋体">可以把一个对象变成持久化状态的对象，说明该对象在一级缓存中也就是</font> <font color="#010101" face="Times New Roman">session</font><font color="#010101" face="宋体">缓存中。如果对该对象进行修改，只是在一级缓存中进行修改，这个时候和数据库没有关系，</font></div><div align="justify" style="font-size: 21px;"><font color="#010101" face="宋体">当程序执行到</font><font color="#010101" face="Times New Roman">session.flush</font><font color="#010101" face="宋体">的时候，让对象和数据库交互。所以在整个过程中，不考虑查询，只有</font> <font color="#010101" face="Times New Roman">session.flush</font><font color="#010101" face="宋体">的时候才要跟数据库交互，所以只交互一次。</font></div></div><div><br/></div><div><br/></div></div>
</div></body></html> 