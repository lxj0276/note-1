<html>
<head>
  <title>文件上传基础</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="1075"/>
<h1>文件上传基础</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/7/18 12:24</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/7/19 8:28</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="mk:@MSITStore:C:\Users\Administrator\Desktop\JavaEE笔记预习.chm::/abe4ba51-5abb-4f33-8e95-bdc89aca1b56.htm"><i>mk:@MSITStore:C:\Users\Administrator\Desktop\JavaEE笔记预习.chm::/abe4ba51-5abb-4f33-8e95-bdc89aca1b56.htm</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><span style="font-size: 32px;"><b><font color="#FF0000">一、文件上传：</font></b></span><div><img src="文件上传基础_files/Image.png" type="image/png" height="566" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1080"/></div><div><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">c<font face="宋体">、表单中提供</font><font face="Times New Roman">type=</font></span><span style="font-family: 'Times New Roman';">”</span><span style="font-family: 宋体;">file</span><span style="font-family: 'Times New Roman';">”</span><span style="font-family: 宋体;">类型的文件上传输入域。</span></p></div><div><br/></div><div><img src="文件上传基础_files/Image [1].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div><br/></div><div style="font-size: 24px;"><b>2、<font face="宋体" style="font-family: 宋体; text-indent: 21pt;">文件上传</font></b></div><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">对请求正文是<font face="Times New Roman">multipart/form-data</font><font face="宋体">类型的数据进行解析</font></span></p><div><img src="文件上传基础_files/Image [2].png" type="image/png" height="595" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1000"/></div><div><span style="font-size: 24px;">实现步骤</span><br style="font-size: 24px;"/><span style="font-size: 24px;">１、创建DiskFileItemFactory对象，设置缓冲区大小和临时文件目录</span><br style="font-size: 24px;"/><span style="font-size: 24px;">２、使用DiskFileItemFactory 对象创建ServletFileUpload对象，并设置上传文件的大小限制。</span><br style="font-size: 24px;"/><span style="font-size: 24px;">３、调用ServletFileUpload.parseRequest方法解析request对象，得到一个保存了所有上传内容的List对象。</span><br style="font-size: 24px;"/><span style="font-size: 24px;">４、对list进行迭代，每迭代一个FileItem对象，调用其isFormField方法判断是否是上传文件</span><br style="font-size: 24px;"/><span style="font-size: 24px;">     为普通表单字段，则调用getFieldName、getString方法得到字段名和字段值</span><br style="font-size: 24px;"/><span style="font-size: 24px;">     为上传文件，则调用getInputStream方法得到数据输入流，从而读取上传数据。</span><br/></div><div><span style="font-size: 24px;"><br/></span></div><div><img src="文件上传基础_files/Image [3].png" type="image/png" height="561" style="cursor: default;cursor: default;cursor: default;" width="962"/></div><div><br/></div><div><img src="文件上传基础_files/Image [4].png" type="image/png" height="559" style="cursor: default;cursor: default;cursor: default;" width="941"/></div><div><p style="margin-left: 63pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;"> </span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">ServletFileUpload<font face="宋体">：核心解析器</font></span></p><div><font face="宋体"><span style="font-size: 24px;">       </span></font><span style="font-size: 24px; font-family: 宋体;">FileItem:<font face="宋体">代表着一个表单上传输入域</font></span></div></div><div><span style="font-family: 宋体;"><font face="宋体"><br/></font></span></div><div style="font-size: 24px;"><b><span style="font-family: 宋体;"><font face="宋体">3、</font></span><font face="宋体" style="font-family: 宋体; text-indent: 21pt;">文件上传时需要考虑的几个问题</font></b></div><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">a<font face="宋体">、服务器的安全</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">解决办法：</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">把上传的文件放到用户无法直接访问的地方（<font face="Times New Roman">WEB-INF</font><font face="宋体">）</font></span></p><div><font face="宋体">                      </font><font face="Consolas"><span style="font-size:12pt">String realPath =</span> <span style="font-size:12pt; background:#d4d4d4">getServletContext</span><span style="font-size:12pt">().getRealPath(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;/WEB-INF/files&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                File storeDirectory =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">File(realPath);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(!storeDirectory.exists()){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     storeDirectory.mkdir();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div><font face="宋体"><span style="font-size: 21px;">        </span></font><span style="font-family: 宋体; font-size: 21px;">限制用户上传文件的类型</span></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><font face="宋体">               </font><font face="Consolas"><span style="font-size:12pt">String mimeType = item.getContentType();</span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//</span> <span style="font-size:12pt"><u>html</u></span><span style="font-size:12pt">----&gt;text/</span> <span style="font-size:12pt"><u>html</u></span><span style="font-size:12pt"> </span> <span style="font-size:12pt"><u>jpeg</u></span><span style="font-size:12pt">---&gt;image/</span><span style="font-size:12pt"><u>jpeg</u></span> <span style="font-size:12pt">(</span><span style="font-size:12pt"><u>Tomcat</u></span><span style="font-size:12pt">\</span> <span style="font-size:12pt"><u>conf</u></span><span style="font-size:12pt">\web.xml)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(!mimeType.startsWith(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;image&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;只能上传图片&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div></blockquote><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">b<font face="宋体">、重名文件被覆盖的问题</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">解决办法：</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">让文件名唯一即可。</span></p><div><font face="宋体"><span style="font-size: 21px;">        </span></font><font face="宋体" style="font-size: 21px;">比如：</font><font face="Times New Roman"><font face="宋体" style="font-size: 21px;">a.txt----&gt;UUID(GUID)_a.txt</font></font></div><div><font face="Times New Roman">                                                  </font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(filename!=</span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font> <font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     filename = GUID.</span><span style="font-size:12pt"><i>generateGUID</i></span><span style="font-size:12pt">()+</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;_&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+FilenameUtils.</span> <span style="font-size:12pt"><i>getName</i></span><span style="font-size:12pt">(filename);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">               </span></font><font face="Consolas" size="4">  </font><span style="font-family: Consolas; font-size: 16px;">}</span></div><div align="left"><font face="Consolas" size="4">                 </font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">GUID {</span></font></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas">                <span style="font-size:12pt">//GUID就是UUID：唯一</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                 </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font face="Consolas"><span style="font-size:12pt">String generateGUID() {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                      </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">BigInteger(165,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">Random()).toString(36).</span><span style="font-size:12pt; background:#d4d4d4">toUpperCase</span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                 } </span></font></div><div align="left"><span style="font-size: 12pt; font-family: Consolas;">             }</span><font face="Consolas" size="4"> </font></div></blockquote><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">c<font face="宋体">、避免上传文件都存到一个目录中</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">方案一：</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">按日期产生目录，把当天上传的放到该目录中。</span></p><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div align="left"><font color="#7F0055" face="Consolas" size="4"><b>       </b></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">String</span> <span style="font-size:12pt"><u>makeChildDirectory(String realPath)</u></span> <span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Date now =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">Date();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           DateFormat df =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">SimpleDateFormat(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;yyyy-MM-dd&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String date = df.format(now);</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//日期部分</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           File file =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">File(realPath, date);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(!file.exists()){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                file.mkdirs();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">date;</span></font></div><div><font face="Consolas" size="4">      </font> <span style="font-family: Consolas; font-size: 12pt;"> }</span></div></blockquote><div><font face="宋体">          </font><span style="font-family: 宋体; font-size: 21px;">方案二：</span></div><div><br/></div><div><font face="宋体">             </font><span style="font-family: 宋体; font-size: 21px;">按照</span><font face="Times New Roman" style="font-size: 21px;">GUID</font><font face="宋体" style="font-family: 宋体; font-size: 21px;">文件名的</font><font face="Times New Roman" style="font-size: 21px;">hash</font><font face="宋体" style="font-family: 宋体; font-size: 21px;">码计算存放目录。</font></div><div><font face="宋体">               </font><span style="color: rgb(63, 127, 95); font-family: Consolas; font-size: 12pt;">//用文件名的hash码计算目录:分2级子目录</span></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">String makeChildDirectory(String realPath,String filename) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>int</b></span></font> <font face="Consolas"><span style="font-size:12pt">hashCode = filename.hashCode();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>int</b></span></font> <font face="Consolas"><span style="font-size:12pt">dir1 = hashCode&amp;0xf;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">/*</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           1100 1101 0101 1101 0000 1111 1010 0101  hashCode</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           0000 0000 0000 0000 0000 0000 0000 1111  0xf</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           -------------------------------------------&amp;</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           0000 0000 0000 0000 0000 0000 0000 0101   取hashCode的0~3位   0000~1111  0~15共16个</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">            */</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>int</b></span></font> <font face="Consolas"><span style="font-size:12pt">dir2 = (hashCode&amp;0xf0)&gt;&gt;4;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">/*</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           1100 1101 0101 1101 0000 1111 1010 0101  hashCode</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           0000 0000 0000 0000 0000 0000 1111 0000   0xf0</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           -------------------------------------------&amp;</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           0000 0000 0000 0000 0000 0000 1010 0000   取hashCode的4~7位   0000~1111  0~15共16个</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           &gt;&gt;4</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">           0000 0000 0000 0000 0000 0000 0000 1010</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">            */</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String childDirectory = dir1+</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;/&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+dir2;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           File file =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">File(realPath,childDirectory);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(!file.exists()){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                file.mkdirs();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">childDirectory;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div></blockquote><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">d<font face="宋体">、中文乱码</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">普通字段：</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">FileItem.getString(<font face="宋体">浏览器用的编码</font><font face="Times New Roman">);</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">中文文件名：</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">request.setCharacterEncoding(</span><span style="font-family: 'Times New Roman';">“</span><span style="font-family: 宋体;">UTF-8</span><span style="font-family: 'Times New Roman';">”</span><span style="font-family: 宋体;">);//<font face="宋体">指示</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;"> </span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">e<font face="宋体">、限制上传文件的类型</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">通过判断文件的<font face="Times New Roman">mime</font><font face="宋体">类型和文件的扩展名来限制上传的文件的。</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">专业做法：获取图片的二进制，找出图片类型的标示二进制代码进行判断。</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">f<font face="宋体">、限制上传文件的大小</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">单个文件大小限制：</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">ServletFileUpload.setFileSizeMax(long size)</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">提示：通过抓取异常<font face="Times New Roman">FileUploadBase.FileSizeLimitExceededException </font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">总文件大小限制：</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">ServletFileUpload.setSizeMax(long size)</span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">提示：通过抓取异常<font face="Times New Roman">FileUploadBase.SizeLimitExceededException</font></span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 21px;"><span style="font-family: 宋体;">g<font face="宋体">、临时文件的问题</font></span></p><div><br/></div><div>           <img src="文件上传基础_files/Image [5].png" type="image/png" height="423" style="cursor: default;cursor: default;cursor: default;" width="1027"/></div><div><p style="margin-bottom: 0pt; margin-top: 0pt; font-size: 32px;"><span style="font-family: 宋体;"><b><font color="#DE5700">二、<font face="Times New Roman">Servlet</font><font face="宋体">规范中的监听器</font></font></b></span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">1<font face="宋体">、由</font><font face="Times New Roman">Frame</font><font face="宋体">的使用说起：观察者设计模式（帮助理解）</font></span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">2<font face="宋体">、</font><font face="Times New Roman">Servlet</font><font face="宋体">规范中的</font><font face="Times New Roman">8</font><font face="宋体">个监听器</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">a<font face="宋体">、监听</font><font face="Times New Roman">ServletContext</font><font face="宋体">、</font><font face="Times New Roman">HttpSession</font><font face="宋体">、</font><font face="Times New Roman">ServletRequest</font><font face="宋体">对象的创建和销毁的监听器。</font></span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">ServletContextListener:<font face="宋体">两个</font></span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">HttpSessionListener:<font face="宋体">两个</font></span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">ServletRequestListener:<font face="宋体">两个</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">b<font face="宋体">、监听</font><font face="Times New Roman">ServletContext</font><font face="宋体">、</font><font face="Times New Roman">HttpSession</font><font face="宋体">、</font><font face="Times New Roman">ServletRequest</font><font face="宋体">属性</font><font face="Times New Roman">(attribute)</font><font face="宋体">变化的监听器</font></span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">ServletContextAttributeListener:<font face="宋体">三个 </font><font face="Times New Roman">setAttribute(</font><font face="宋体">第一次添加，第二次修改</font><font face="Times New Roman">)removeAttribute()  </font></span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">HttpSessionAttributeListener:<font face="宋体">三个</font></span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">ServletRequestAttributeListener:<font face="宋体">三个</font></span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">c<font face="宋体">、感知型监听器（不需要注册）</font></span></p><p style="margin-left: 42pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 24px;"><span style="font-family: 宋体;">HttpSessionBindingListener:<font face="宋体">实现这个接口类的实例，绑到（解绑）</font><font face="Times New Roman">HttpSession</font><font face="宋体">域中会被监听到</font></span></p></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="font-size: 24px;"><span style="font-family: 宋体;">HttpSessionActivationListener:<font face="宋体">实现这个接口类的实例，感知自己何时会随着</font><font face="Times New Roman">HttpSession</font><font face="宋体">对象钝化或激活。</font></span></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="font-size: 24px;">监听器一般都是接口,谁用,谁实现</div></blockquote></blockquote></div>
</div></body></html> 