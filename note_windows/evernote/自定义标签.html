<html>
<head>
  <title>自定义标签</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="1388"/>
<h1>自定义标签</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/7/20 9:53</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/7/20 10:52</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.cnblogs.com/zhaoyang/archive/2011/12/25/2301108.html"><i>http://www.cnblogs.com/zhaoyang/archive/2011/12/25/2301108.html</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><span style="font-size: 32px;"><b>一、自定义标签简介</b></span><div><span style="font-size: 24px;">作用：</span><br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><span style="font-size: 24px;">自定义标签主要用于移除Jsp页面中的java代码。</span></div><div><span style="font-size: 24px;">控制jsp页面某一部分内容是否执行。</span></div><div><span style="font-size: 24px;">控制结束标签后的JSP内容</span><span style="font-size: 24px;">     </span><span style="font-size: 24px;">是否执行</span></div><div><span style="font-size: 24px;">控制jsp页面内容重复执行。</span></div><div><span style="font-size: 24px;">修改页面内容输出。</span></div></blockquote><div><p style="font-size: 21px;">一般情况下开发jsp自定义标签需要引用以下两个包</p><p align="left" style="font-size: 21px;"><strong>import</strong> javax.servlet.jsp.*;</p><div style="font-size: 21px;"><strong>import</strong> javax.servlet.jsp.tagext.*;</div></div><div style="font-size: 21px;"><img src="自定义标签_files/Image.png" type="image/png" style="cursor: default;"/></div><div><br/></div><div>使用自定义标签移除jsp页面中的java代码，只需要完成以下两个步骤：<br/>
编写一个实现Tag接口的Java类(标签处理器类)。<br/>
编写标签库描述符（tld）文件，在tld文件中把标签处理器类进行描述。</div><div style="font-size: 32px;"><b>二、</b>SimpleTag接口</div><div><span style="font-size: 24px;">1.简单标签共定义了5个方法：</span><br style="font-size: 24px;"/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><span style="font-size: 24px;">setJspContext方法</span></div><div><span style="font-size: 24px;">setParent方法</span></div><div><span style="font-size: 24px;">getParent方法</span></div><div><span style="font-size: 24px;">setJspBody方法</span></div><div><span style="font-size: 24px;">doTag方法</span></div></blockquote><div style="font-size: 21px;">setJspContext方法<br/>
用于把JSP页面的pageContext对象传递给标签处理器对象<br/>
setParent方法<br/>
用于把父标签处理器对象传递给当前标签处理器对象<br/>
getParent方法<br/>
用于获得当前标签的父标签处理器对象<br/>
setJspBody方法<br/>
用于把代表标签体的JspFragment对象传递给标签处理器对象<br/>
doTag方法<br/>
用于完成所有的标签逻辑，包括输出、迭代、修改标签体内容等。在doTag方法中可以抛出javax.servlet.jsp.SkipPageException异常，用于通知WEB容器不再执行JSP页面中位于结束标记后面的内容，这等效于在传统标签的doEndTag方法中返回Tag.SKIP_PAGE常量的情况。</div><div><span style="font-size: 24px;">2.</span><b style="font-size: 24px;">Lifecycle</b></div><div><ol><li style="font-size: 21px;">A new tag handler instance is created each time by the container by calling the provided zero-args constructor. Unlike classic tag handlers, simple tag handlers are never cached and reused by the JSP container.</li><li style="font-size: 21px;">The <code>setJspContext()</code> and <code>setParent()</code> methods are called by the container. The <code>setParent()</code> method is only called if the element is nested within another tag invocation.</li><li style="font-size: 21px;">The setters for each attribute defined for this tag are called by the container.</li><li style="font-size: 21px;">If a body exists, the <code>setJspBody()</code> method is called by the container to set the body of this tag, as a <code>JspFragment</code>. If the action element is empty in the page, this method is not called at all.</li><li style="font-size: 21px;">The <font color="#E30000"><code>doTag()</code></font> method is called by the container. <font color="#E30000">All tag logic, iteration, body evaluations</font>, etc. occur in this method.</li></ol></div><div><span style="font-size: 32px;">三、</span><b style="font-size: 32px;">SimpleTagSupport  </b><span style="font-size: 32px;">implements</span> <a href="mk:javax/servlet/jsp/tagext/SimpleTag.html" style="font-size: 32px;" title="interface in javax.servlet.jsp.tagext">SimpleTag</a></div><div><p style="font-size: 19px;">SimpleTagSupport 类实现 SimpleTag 接口，并添加了其他便捷方法</p></div><div><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="#CCCCFF"><th align="left" colspan="2"><font size="+2"><b>Method Summary</b></font></th></tr><tr bgcolor="white"><td align="right" style="font-size: 15px;" valign="top" width="1%"><code> void</code></td><td style="font-size: 15px;"><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#doTag()">doTag</a></b>()</code><br/>
          Default processing of the tag does nothing.</td></tr><tr bgcolor="white" style="font-size: 15px;"><td align="right" valign="top" width="1%"><code>static <a href="mk:javax/servlet/jsp/tagext/JspTag.html" title="interface in javax.servlet.jsp.tagext">JspTag</a></code></td><td><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#findAncestorWithClass(javax.servlet.jsp.tagext.JspTag,%20java.lang.Class)">findAncestorWithClass</a></b>(<a href="mk:javax/servlet/jsp/tagext/JspTag.html" title="interface in javax.servlet.jsp.tagext">JspTag</a> from, <a href="http://java.sun.com/j2se/1.5/docs/api/java/lang/Class.html" title="class or interface in java.lang">Class</a>&lt;?&gt; klass)</code><br/>
          Find the instance of a given class type that is closest to a given instance.</td></tr><tr bgcolor="white" style="font-size: 15px;"><td align="right" valign="top" width="1%"><code>protected  <a href="mk:javax/servlet/jsp/tagext/JspFragment.html" title="class in javax.servlet.jsp.tagext">JspFragment</a></code></td><td><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#getJspBody()">getJspBody</a></b>()</code><br/>
          Returns the body passed in by the container via setJspBody.</td></tr><tr bgcolor="white" style="font-size: 15px;"><td align="right" valign="top" width="1%"><code>protected  <a href="mk:javax/servlet/jsp/JspContext.html" title="class in javax.servlet.jsp">JspContext</a></code></td><td><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#getJspContext()">getJspContext</a></b>()</code><br/>
          Returns the page context passed in by the container via setJspContext.</td></tr><tr bgcolor="white" style="font-size: 15px;"><td align="right" valign="top" width="1%"><code> <a href="mk:javax/servlet/jsp/tagext/JspTag.html" title="interface in javax.servlet.jsp.tagext">JspTag</a></code></td><td><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#getParent()">getParent</a></b>()</code><br/>
          Returns the parent of this tag, for collaboration purposes.</td></tr><tr bgcolor="white" style="font-size: 15px;"><td align="right" valign="top" width="1%"><code> void</code></td><td><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#setJspBody(javax.servlet.jsp.tagext.JspFragment)">setJspBody</a></b>(<a href="mk:javax/servlet/jsp/tagext/JspFragment.html" title="class in javax.servlet.jsp.tagext">JspFragment</a> jspBody)</code><br/>
          Stores the provided JspFragment.</td></tr><tr bgcolor="white" style="font-size: 15px;"><td align="right" valign="top" width="1%"><code> void</code></td><td><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#setJspContext(javax.servlet.jsp.JspContext)">setJspContext</a></b>(<a href="mk:javax/servlet/jsp/JspContext.html" title="class in javax.servlet.jsp">JspContext</a> pc)</code><br/>
          Stores the provided JSP context in the private jspContext field.</td></tr><tr bgcolor="white"><td align="right" style="font-size: 15px;" valign="top" width="1%"><code> void</code></td><td style="font-size: 15px;"><code><b><a href="mk:javax/servlet/jsp/tagext/SimpleTagSupport.html#setParent(javax.servlet.jsp.tagext.JspTag)">setParent</a></b>(<a href="mk:javax/servlet/jsp/tagext/JspTag.html" title="interface in javax.servlet.jsp.tagext">JspTag</a> parent)</code><br/>
          Sets the parent of this tag, for collaboration purposes.</td></tr></tbody></table></div><div style="font-size: 32px;"><b>四、JspFragment</b></div><div style="font-size: 24px;">1.The definition of the JspFragment must only contain template text and JSP action elements. </div><div><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="white"><td align="right" style="font-size: 19px;" valign="top" width="1%"><code>abstract  <a href="mk:javax/servlet/jsp/JspContext.html" title="class in javax.servlet.jsp">JspContext</a></code></td><td style="font-size: 19px;"><code><b><a href="mk:javax/servlet/jsp/tagext/JspFragment.html#getJspContext()">getJspContext</a></b>()</code><br/>
          Returns the JspContext that is bound to this JspFragment.</td></tr><tr bgcolor="white"><td align="right" style="font-size: 19px;" valign="top" width="1%"><code>abstract  void</code></td><td style="font-size: 19px;"><code><b><a href="mk:javax/servlet/jsp/tagext/JspFragment.html#invoke(java.io.Writer)">invoke</a></b>(<a href="http://java.sun.com/j2se/1.5/docs/api/java/io/Writer.html" title="class or interface in java.io">Writer</a> out)</code><br/>
          Executes the fragment and directs all output to the given Writer, or the JspWriter returned by the getOut() method of the JspContext associated with the fragment if out is null.</td></tr></tbody></table><span style="font-size: 24px;">2.invoke方法详解  </span></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="font-size: 21px;">JspFragment.invoke方法是JspFragment最重要的方法，利用这个方法可以控制是否执行和输出标签体的内容、是否迭代执行标签体的内容或对标签体的执行结果进行修改后再输出。例如：</div><span style="font-size: 21px;">在标签处理器中如果没有调用JspFragment.invoke方法，其结果就相当于忽略标签体内容；<br/></span><span style="font-size: 21px;">在标签处理器中重复调用JspFragment.invoke方法，则标签体内容将会被重复执行；<br/></span><span style="font-size: 21px;">若想在标签处理器中修改标签体内容，只需在调用invoke方法时指定一个可取出结果数据的输出流对象（例如StringWriter），让标签体的执行结果输出到该输出流对象中，然后从该输出流对象中取出数据进行修改后</span><span style="font-size: 21px;">再输出到目标设备，即可达到修改标签体的目的。</span></blockquote><div style="font-size: 32px;"><b><br/></b></div><div style="font-size: 32px;"><b>五、开发带属性的标签</b></div><div style="font-size: 24px;">通过这些属性为标签处理器传递参数信息，从而提高标签的灵活性和复用性。</div><div style="font-size: 24px;">要想让一个自定义标签具有属性，通常需要完成两个任务：<br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="font-size: 24px;">在标签处理器中编写每个属性对应的setter方法</div><div style="font-size: 24px;">在TLD文件中描术标签的属性</div></blockquote><div><span style="font-size: 24px;">在标签处理器中定义相应的set方法后，JSP引擎在解析执行开始标签前，也就是调用doStartTag方法前，会调用set属性方法，为标签设置属性。</span><br/></div><div><img src="自定义标签_files/Image [1].png" type="image/png" style="cursor: default;"/></div><div style="font-size: 24px;"><b><br/></b></div><div style="font-size: 24px;"><b>六、PageContext extends <a href="mk:javax/servlet/jsp/JspContext.html" title="class in javax.servlet.jsp">JspContext</a></b></div><div><br/></div><div><br/></div><div><p style="font-size: 21px;"><b>供容器生成的代码使用的方法</b></p><div><span style="font-size: 19px;">     支持</span><b style="font-size: 19px;">生命周期</b><span style="font-size: 19px;">的方法是</span> <code style="font-size: 19px;">initialize()</code> <span style="font-size: 19px;">和</span> <code style="font-size: 19px;">release()</code><span style="font-size: 19px;">。</span></div></div><div><p style="font-size: 21px;"><b>供 JSP 作者使用的方法</b></p></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><p style="font-size: 19px;">以下方法提供对隐式对象的<b>便捷访问</b>：<code>getException()</code>、<code>getPage()</code>、<code>getRequest()</code>、<code>getResponse()</code>、<code>getSession()</code>、<code>getServletConfig()</code> 和 <code>getServletContext()</code>。</p></div><div><p style="font-size: 19px;">以下方法提供对<b>转发、包含和错误处理</b>的支持：<code>forward()</code>、<code>include()</code> 和 <code>handlePageException()</code>。 </p></div></blockquote><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 21px;"><br/></span><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="font-size: 21px;"><br/></div><div style="font-size: 21px;"><br/></div></blockquote></div></div>
</div></body></html> 