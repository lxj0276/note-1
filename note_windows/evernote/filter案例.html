<html>
<head>
  <title>filter案例</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="863"/>
<h1>filter案例</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/7/16 22:25</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/7/22 7:33</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="file:///"><i>file:///</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><font color="#41AD1C"><span style="font-size: 32px;">一、<b>设置</b></span><b><span style="font-family: Consolas; text-align: -webkit-left; font-size: 32px;">动</span><span style="font-family: Consolas; text-align: -webkit-left; font-size: 32px;">态资源不要缓存</span></b></font><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">DynamicResourcesNoCacheFilter</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>implements</b></span></font> <font face="Consolas"><span style="font-size:12pt">Filter {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">init(FilterConfig filterConfig)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletRequest request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletResponse response;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font><font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                request = (HttpServletRequest)req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response = (HttpServletResponse)resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font><font face="Consolas"><span style="font-size:12pt">(ClassCastException e){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">RuntimeException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-http request&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.setHeader(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Expires&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;-1&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.setHeader(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Cache-Control&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;no-cache&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.setHeader(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Pragma&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;no-cache&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           chain.doFilter(request, response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">destroy() {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left" style="font-size: 24px;"><font face="Consolas"><b>web.xml的配置</b></font></div><div align="left"><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">DynamicResourcesNoCacheFilter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-class</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">com.itheima.filter.DynamicResourcesNoCacheFilter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-class</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">DynamicResourcesNoCacheFilter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">*.</span><span style="font-size:14pt"><u>jsp</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">DynamicResourcesNoCacheFilter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">/</span><span style="font-size:14pt"><u>servlet</u></span><span style="font-size:14pt">/*</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font></div></div><div align="left" style="font-size: 32px;"><font color="#41AD1C" face="Consolas">二、解决post请求的编码问题</font></div><div align="left"><div><b style="font-family: Consolas; font-size: 24px;">web.xml的配置</b></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">SetCharacterEncodingFilter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-class</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">com.itheima.filter.SetCharacterEncodingFilter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-class</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">encoding</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font> <font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">UTF-8</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font> <font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">SetCharacterEncodingFilter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">/*</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font> <font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div></div><div align="left"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest request, ServletResponse response,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span> <span style="font-size:12pt; background:#d4d4d4">String</span> <span style="font-size:12pt">value =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font><font face="Consolas"><span style="font-size:12pt">.getInitParameter(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;encoding&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(value==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                value =</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;UTF-8&quot;</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//默认值</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           request.setCharacterEncoding(value);</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//只能 解决POST请求</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.setContentType(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;text/html;charset=&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+value);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           chain.doFilter(request, response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas" size="4"><br/></font></div><div align="left" style="font-size: 32px;"><font color="#41AD1C" face="Consolas">三、设置不同静态资源缓存不同时间：</font></div><div align="left"><div><b style="font-family: Consolas; font-size: 24px;">web.xml的配置</b></div><div align="left"><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">StaticResourcesNeedCache</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-class</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">com.itheima.filter.StaticResourcesNeedCache</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-class</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt"><u>html</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">1</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font> <font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt">&lt;!-- 小时 --&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt"><u>js</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">2</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font> <font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt">&lt;!-- 小时 --&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt"><u>css</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">              </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">3</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font> <font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">param-value</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt">&lt;!-- 小时 --&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">init-param</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">StaticResourcesNeedCache</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">*.</span><span style="font-size:14pt"><u>html</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">StaticResourcesNeedCache</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">*.</span><span style="font-size:14pt"><u>css</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">StaticResourcesNeedCache</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-name</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">*.</span><span style="font-size:14pt"><u>js</u></span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">url-pattern</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&lt;/</span></font><font color="#3F7F7F" face="Consolas" size="4"><span style="font-size:14pt">filter-mapping</span></font> <font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">&gt;</span></font></div><div align="left"><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">StaticResourcesNeedCache</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>implements</b></span></font> <font face="Consolas"><span style="font-size:12pt">Filter {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">FilterConfig</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">init(FilterConfig filterConfig)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font> <font face="Consolas"><span style="font-size:12pt">= filterConfig;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas" size="4"><br/></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletRequest request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletResponse response;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font><font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                request = (HttpServletRequest)req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response = (HttpServletResponse)resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font><font face="Consolas"><span style="font-size:12pt">(ClassCastException e){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">RuntimeException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-http request&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>long</b></span></font> <font face="Consolas"><span style="font-size:12pt">time = 0;</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//缓存的时间毫秒</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//根据用户的访问资源的类型，读取对应的参数的值，设置缓存的时间</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String uri = request.getRequestURI();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//  /day19_00_filter/1.</span><span style="font-size:12pt"><u>html</u></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String subname = uri.substring(uri.lastIndexOf(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;.&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">)+1);</span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//截取扩展名</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//获取配置文件中的对应的缓存时间</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;html&quot;</span></font><font face="Consolas"><span style="font-size:12pt">.equals(subname)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//说明访问的是</span><span style="font-size:12pt"><u>html</u></span><span style="font-size:12pt">文件</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                String value =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font><font face="Consolas"><span style="font-size:12pt">.getInitParameter(subname);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                time = Long.</span> <span style="font-size:12pt"><i>parseLong</i></span><span style="font-size:12pt">(value)*60*60*1000;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;css&quot;</span></font><font face="Consolas"><span style="font-size:12pt">.equals(subname)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//说明访问的是</span><span style="font-size:12pt"><u>html</u></span><span style="font-size:12pt">文件</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                String value =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font><font face="Consolas"><span style="font-size:12pt">.getInitParameter(subname);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                time = Long.</span> <span style="font-size:12pt"><i>parseLong</i></span><span style="font-size:12pt">(value)*60*60*1000;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;js&quot;</span></font><font face="Consolas"><span style="font-size:12pt">.equals(subname)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//说明访问的是</span><span style="font-size:12pt"><u>html</u></span><span style="font-size:12pt">文件</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                String value =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font><font face="Consolas"><span style="font-size:12pt">.getInitParameter(subname);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                time = Long.</span> <span style="font-size:12pt"><i>parseLong</i></span><span style="font-size:12pt">(value)*60*60*1000;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.setDateHeader(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Expires&quot;</span></font><font face="Consolas"><span style="font-size:12pt">, System.</span><span style="font-size:12pt"><i>currentTimeMillis</i></span><span style="font-size:12pt">()+time);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           chain.doFilter(request, response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">destroy() {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left" style="font-size: 32px;"><font color="#41AD1C" face="Consolas">四、自动登录过滤器</font></div><div align="left" style="font-size: 21px;"><font face="Consolas"><b>1.在登录的Servlet中添加的代码：</b></font></div><div align="left"><img src="filter案例_files/Image.png" type="image/png" height="503" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1121"/></div><div align="left" style="font-size: 21px;"><b>2、过滤器中：</b></div><div align="left"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletRequest request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletResponse response;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font><font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                request = (HttpServletRequest)req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response = (HttpServletResponse)resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font><font face="Consolas"><span style="font-size:12pt">(ClassCastException e){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">RuntimeException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-http request&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//监测用户是否登录</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpSession session = request.getSession();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           User user = (User) session.getAttribute(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;user&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//没有登录的情况：</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(user==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//读取指定的cookie：loginInfo</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                Cookie loginInfoCookie =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                Cookie cs[] =request.getCookies();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>int</b></span></font> <font face="Consolas"><span style="font-size:12pt">i=0;cs!=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">&amp;&amp;i&lt;cs.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">length</span></font><font face="Consolas"><span style="font-size:12pt">;i++){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;loginInfo&quot;</span></font><font face="Consolas"><span style="font-size:12pt">.equals(cs[i].getName())){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           loginInfoCookie = cs[i];</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>break</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//如果有：解出用户名（Base64）和密码</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(loginInfoCookie!=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//再次验证用户名和密码是否正确</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     String value = loginInfoCookie.getValue();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     String usernameBase64 = value.split(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;_&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)[0];</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     String passwordMD5 = value.split(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;_&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)[1];</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     user =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">s</span></font><font face="Consolas"><span style="font-size:12pt">.findUser(EncodingUtil.</span> <span style="font-size:12pt"><i>base64Decode</i></span><span style="font-size:12pt">(usernameBase64), passwordMD5);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(user!=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//如果正确：放到HttpSession中即可</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           session.setAttribute(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;user&quot;</span></font><font face="Consolas"><span style="font-size:12pt">, user);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//放行</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           chain.doFilter(request, response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><div style="font-size: 21px;"><span style="font-family: Consolas;"><b>3.在注销的Servlet中添加的代码：</b></span></div><div><img src="filter案例_files/Image [1].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div style="font-size: 21px;"><b>4.在web.xml中配置</b></div><div><img src="filter案例_files/Image [2].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div><br/></div><div style="font-size: 32px;"><font color="#41AD1C"><b>五、脏话过滤</b></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">DirtyWordsFilter</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>implements</b></span></font> <font face="Consolas"><span style="font-size:12pt">Filter {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">init(FilterConfig filterConfig)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletRequest request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletResponse response;</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                request = (HttpServletRequest) req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response = (HttpServletResponse) resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(ClassCastException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-HTTP request or response&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><font size="4">          </font><font color="#FF0000"><font size="4"> </font><span style="font-size: 21px;">DirtyWordsHttpServletRequest dwrequest =</span></font></font> <font color="#FF0000" style="font-size: 21px;"><font face="Consolas"><b>new</b></font> <font face="Consolas">DirtyWordsHttpServletRequest(request);</font></font></div><div align="left"><font face="Consolas"><font size="4">           chain.doFilter(</font><font color="#E30000" style="font-size: 21px;">dwrequest</font><font size="4">, response);</font></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">destroy() {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">DirtyWordsHttpServletRequest</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>extends</b></span></font> <font face="Consolas"><span style="font-size:12pt">HttpServletRequestWrapper{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     String</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">dw</span></font><font face="Consolas"><span style="font-size:12pt">[] = {</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;禽兽&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;畜生&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;搞基&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">};</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">DirtyWordsHttpServletRequest(<font color="#E30000">HttpServletRequest request</font>){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">(request);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><font color="#E30000" style="font-size: 21px;">String getParameter(String name)</font> <font size="4">{</font></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String value =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">.getParameter(name);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(value==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(String s:</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">dw</span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(value.contains(s)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     value = value.replace(s,</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;**&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">value;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><img src="filter案例_files/Image [3].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div align="left"><br/></div><div align="left" style="font-size: 32px;"><font color="#41AD1C"><b>六、防止HTML注入</b></font></div><div align="left"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">HtmlFilter</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>implements</b></span></font> <font face="Consolas"><span style="font-size:12pt">Filter {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">init(FilterConfig filterConfig)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">destroy() {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletRequest request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletResponse response;</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                request = (HttpServletRequest) req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response = (HttpServletResponse) resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(ClassCastException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-HTTP request or response&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><font size="4">          </font><font color="#E30000" style="font-size: 21px;"> HtmlHttpServletRequest htmlRequest =</font></font> <font color="#E30000" style="font-size: 21px;"><font face="Consolas"><b>new</b></font> <font face="Consolas">HtmlHttpServletRequest(request);</font></font></div><div align="left"><font face="Consolas"><font size="4">           chain.doFilter(</font><font color="#E30000" style="font-size: 21px;">htmlRequest</font><font size="4">, response);</font></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">HtmlHttpServletRequest</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>extends</b></span></font> <font face="Consolas"><span style="font-size:12pt">HttpServletRequestWrapper{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">HtmlHttpServletRequest(HttpServletRequest request){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">(request);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String getParameter(String name) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String value =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">.getParameter(name);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(value==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//替换特殊标记</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           value = htmlFilter(value);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">value;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">String htmlFilter(String message) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           //tomcat中代码</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font> <font face="Consolas"><span style="font-size:12pt">(message ==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">       </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>char</b></span></font> <font face="Consolas"><span style="font-size:12pt">content[] =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>char</b></span></font><font face="Consolas"><span style="font-size:12pt">[message.length()];</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        message.getChars(0, message.length(), content, 0);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        StringBuffer result =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">StringBuffer(content.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">length</span></font> <font face="Consolas"><span style="font-size:12pt">+ 50);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">       </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font> <font face="Consolas"><span style="font-size:12pt">(</span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>int</b></span></font> <font face="Consolas"><span style="font-size:12pt">i = 0; i &lt; content.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">length</span></font><font face="Consolas"><span style="font-size:12pt">; i++) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>switch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(content[i]) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>case</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">'&lt;'</span></font><font face="Consolas"><span style="font-size:12pt">:</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                result.append(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;&amp;lt;&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">               </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>break</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>case</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">'&gt;'</span></font><font face="Consolas"><span style="font-size:12pt">:</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                result.append(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;&amp;gt;&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">               </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>break</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>case</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">'&amp;'</span></font><font face="Consolas"><span style="font-size:12pt">:</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                result.append(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;&amp;amp;&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">               </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>break</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>case</b></span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">'&quot;'</span></font><font face="Consolas"><span style="font-size:12pt">:</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                result.append(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;&amp;quot;&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">               </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>break</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>default</b></span></font><font face="Consolas"><span style="font-size:12pt">:</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                result.append(content[i]);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">       </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">(result.toString());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left" style="font-size: 32px;"><font color="#41AD1C" face="Consolas">七、解决全部乱码问题（get，post)</font></div><div align="left"><font face="Consolas" size="4"><br/></font></div><div align="left"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">SetAllCharacterEncodingFilter</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>implements</b></span></font> <font face="Consolas"><span style="font-size:12pt">Filter {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">FilterConfig</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">init(FilterConfig filterConfig)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font> <font face="Consolas"><span style="font-size:12pt">= filterConfig;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletRequest request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           HttpServletResponse response;</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                request = (HttpServletRequest) req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response = (HttpServletResponse) resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(ClassCastException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-HTTP request or response&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//得到配置的参数</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String encoding =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">filterConfig</span></font><font face="Consolas"><span style="font-size:12pt">.getInitParameter(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;encoding&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(encoding==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                encoding =</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;UTF-8&quot;</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           request.setCharacterEncoding(encoding);</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//POST请求参数中文</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.setCharacterEncoding(encoding);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">          response.setContentType(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;text/html;charset=&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+encoding);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">         //-------------下面为get乱码的解决--------------------------  </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           MyHttpServletRequest mrequest =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyHttpServletRequest(request);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           chain.doFilter(mrequest, response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">destroy() {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyHttpServletRequest</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>extends</b></span></font> <font face="Consolas"><span style="font-size:12pt">HttpServletRequestWrapper{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyHttpServletRequest(HttpServletRequest request){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">(request);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">String getParameter(String name) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String method =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">.getMethod();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//请求方式</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String value =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">.getParameter(name);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(value==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;get&quot;</span></font><font face="Consolas"><span style="font-size:12pt">.equalsIgnoreCase(method)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//get方式</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     value =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">String(value.getBytes(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;ISO-8859-1&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">),</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;UTF-8&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(UnsupportedEncodingException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     e.printStackTrace();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">value;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left" style="font-size: 32px;"><font color="#41AD1C" face="Consolas">八、gzip压缩并且解决不存在乱码（难点）：</font></div><div align="left" style="font-size: 32px;"><font color="#41AD1C" face="Consolas"><br/></font></div><div align="left" style="font-size: 32px;"><a href="filter案例_files/Gzip压缩过滤器防晕图.doc"><img src="filter案例_files/818f14cb726e97b152d0de1df9f1620a.png" alt="Gzip压缩过滤器防晕图.doc"></a><font color="#41AD1C" face="Consolas"><br/></font></div><div align="left" style="font-size: 32px;"><font color="#41AD1C" face="Consolas"><br/></font></div><div align="left" style="font-size: 21px;"><font face="Consolas">编写过滤器：</font></div><div align="left"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">GzipFilter</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>implements</b></span></font> <font face="Consolas"><span style="font-size:12pt">Filter {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">init(FilterConfig filterConfig)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            HttpServletRequest  request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        HttpServletResponse response;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">       </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">       </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            request = (HttpServletRequest) req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            response = (HttpServletResponse) resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(ClassCastException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-HTTP request or response&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        GzipHttpServletResponse gresponse =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">GzipHttpServletResponse(response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           chain.doFilter(request, gresponse);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>byte</b></span></font> <font face="Consolas"><span style="font-size:12pt">b[] = gresponse.getBytes();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//未压缩前的数据</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//获取请求消息头</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String headervalue = request.getHeader(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Accept-Encoding&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(headervalue.contains(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;gzip&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//浏览器支持</span><span style="font-size:12pt"><u>gzip</u></span><span style="font-size:12pt">压缩</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;压缩前大小：&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+b.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">length</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//压缩后输出</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                ByteArrayOutputStream out =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream();</span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//缓存字节输出流</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                GZIPOutputStream gout =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">GZIPOutputStream(out);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                gout.write(b);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                gout.close();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//保证所有数据都进入了ByteArrayOutputStream中</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                b = out.toByteArray();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;压缩后大小：&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+b.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">length</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//告知浏览器：正文的压缩编码</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response.setHeader(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Content-Encoding&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;gzip&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.getOutputStream().write(b);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">destroy() {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">GzipHttpServletResponse</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>extends</b></span></font> <font face="Consolas"><span style="font-size:12pt">HttpServletResponseWrapper{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream();</span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//临时存放数据的地方</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">PrintWriter</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">pw</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">GzipHttpServletResponse(HttpServletResponse response){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">(response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">     //截获输出的字节信息:(复写的getOutputStream方法)</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletOutputStream getOutputStream()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyServletOutputStream(</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//截获输出的字符流:(复写的getWriter方法)</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4">    </font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">PrintWriter getWriter()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException {</span></font></div><div align="left"><font face="Consolas" size="4">           //因为PrintWriter本来就是一个包装类，把baos穿进去，调用的就是bao中的方法，所以不用像字节流那</font></div><div align="left"><font face="Consolas" size="4">                  //样</font><span style="font-family: Consolas; font-size: large;">还得new一个新的类</span></div><div align="left"><font color="#0000C0" face="Consolas" size="4">           </font><span style="color: rgb(63, 127, 95); font-family: Consolas; font-size: 12pt; background-color: rgb(232, 242, 254); background-position: initial initial; background-repeat: initial initial;">//</span><span style="color: rgb(63, 127, 95); font-family: Consolas; font-size: 12pt; background-color: rgb(232, 242, 254); background-position: initial initial; background-repeat: initial initial;"><u>pw</u></span> <span style="color: rgb(63, 127, 95); font-family: Consolas; font-size: 12pt; background-color: rgb(232, 242, 254); background-position: initial initial; background-repeat: initial initial;">= new PrintWriter(</span><span style="color: rgb(63, 127, 95); font-family: Consolas; font-size: 12pt; background-color: rgb(232, 242, 254); background-position: initial initial; background-repeat: initial initial;"><u>baos</u></span><span style="color: rgb(63, 127, 95); font-family: Consolas; font-size: 12pt; background-color: rgb(232, 242, 254); background-position: initial initial; background-repeat: initial initial;">);</span></div><div align="left"><div><font color="#3F7F5F" face="Consolas" size="4">          </font><span style="background-color: rgb(232, 242, 254); color: rgb(63, 127, 95); font-family: Consolas; font-size: 16px;">//将字节流转变成字符流</span></div></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">pw</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">PrintWriter(</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">OutputStreamWriter(</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">.getCharacterEncoding()));</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">pw</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>byte</b></span></font><font face="Consolas"><span style="font-size:12pt">[] getBytes(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas" size="4">               //判断是不是字符流</font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">pw</span></font><font face="Consolas"><span style="font-size:12pt">!=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">pw</span></font><font face="Consolas"><span style="font-size:12pt">.close();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div align="left"><font face="Consolas" size="4">               //字节流，字符流通用</font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">.flush();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(IOException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                e.printStackTrace();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">.toByteArray();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyServletOutputStream</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>extends</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletOutputStream{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyServletOutputStream(ByteArrayOutputStream baos){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font> <font face="Consolas"><span style="font-size:12pt">= baos;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">write(</span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>int</b></span></font> <font face="Consolas"><span style="font-size:12pt">b)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">.write(b);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div></div><div align="left"><font face="Consolas" size="4"><br/></font></div><div align="left" style="font-size: 16px;"><font face="Consolas">&lt;!--------------------------------------------------------------------------------------&gt;</font></div><div align="left" style="font-size: 19px;"><font face="Consolas">为了便于理解，下面贴出只实现字节流压缩的情况，字符流只在此基础上增加了少许代码。（字符流要注意乱码）</font></div><div align="left"><img src="filter案例_files/Image [4].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div align="left"><br/></div><div align="left"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class </b></span></font><font face="Consolas"><span style="font-size: 12pt;">GzipFilterOnlyOutputStream </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>implements</b></span></font> <font face="Consolas"><span style="font-size:12pt">Filter {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">init(FilterConfig filterConfig)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">doFilter(ServletRequest req, ServletResponse resp,</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                FilterChain chain)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException, ServletException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            HttpServletRequest  request;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        HttpServletResponse response;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">       </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">       </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            request = (HttpServletRequest) req;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            response = (HttpServletResponse) resp;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(ClassCastException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletException(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;non-HTTP request or response&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">        GzipHttpServletResponse gresponse =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">GzipHttpServletResponse(response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">            </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           chain.doFilter(request, gresponse);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>byte</b></span></font> <font face="Consolas"><span style="font-size:12pt">b[] = gresponse.getBytes();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//未压缩前的数据</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//获取请求消息头</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           String headervalue = request.getHeader(</span></font><font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Accept-Encoding&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(headervalue.contains(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;gzip&quot;</span></font><font face="Consolas"><span style="font-size:12pt">)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//浏览器支持</span><span style="font-size:12pt"><u>gzip</u></span><span style="font-size:12pt">压缩</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;压缩前大小：&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+b.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">length</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//压缩后输出</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                ByteArrayOutputStream out =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream();</span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//缓存字节输出流</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                GZIPOutputStream gout =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">GZIPOutputStream(out);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                gout.write(b);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                gout.close();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//保证所有数据都进入了ByteArrayOutputStream中</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                b = out.toByteArray();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;压缩后大小：&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">+b.</span></font><font color="#0000C0" face="Consolas"><span style="font-size:12pt">length</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//告知浏览器：正文的压缩编码</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                response.setHeader(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;Content-Encoding&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;gzip&quot;</span></font> <font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           response.getOutputStream().write(b);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">destroy() {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">GzipHttpServletResponse</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>extends</b></span></font> <font face="Consolas"><span style="font-size:12pt">HttpServletResponseWrapper{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream();</span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//临时存放数据的地方</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">GzipHttpServletResponse(HttpServletResponse response){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>super</b></span></font><font face="Consolas"><span style="font-size:12pt">(response);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//截获输出的字节信息:</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletOutputStream getOutputStream()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyServletOutputStream(</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>byte</b></span></font><font face="Consolas"><span style="font-size:12pt">[] getBytes(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">.flush();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(IOException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                e.printStackTrace();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">.toByteArray();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyServletOutputStream</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>extends</b></span></font> <font face="Consolas"><span style="font-size:12pt">ServletOutputStream{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">ByteArrayOutputStream</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">MyServletOutputStream(ByteArrayOutputStream baos){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>this</b></span></font><font face="Consolas"><span style="font-size:12pt">.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font> <font face="Consolas"><span style="font-size:12pt">= baos;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">write(</span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>int</b></span></font> <font face="Consolas"><span style="font-size:12pt">b)</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">IOException {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">baos</span></font><font face="Consolas"><span style="font-size:12pt">.</span> <span style="font-size:12pt"><u>write</u></span><span style="font-size:12pt">(b);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div></div><div align="left"><font face="Consolas" size="4"><br/></font></div></div></div></div></div></div></div></div></div>
</div></body></html> 