<html>
<head>
  <title>04关系部分</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="5401"/>
<h1>04关系部分</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/8/6 10:10</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/8/28 0:50</i></td></tr>
<tr><td><b>标签：</b></td><td><i>Hibernate, 关系维护</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="file:///"><i>file:///</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><p align="justify" style="margin: 4.57mm 0mm; text-indent: 0mm;"><font color="#010101" face="Times New Roman"><span style="font-size: 21px; line-height: 27px;">      </span></font><font color="#010101" face="Times New Roman" size="4" style="line-height: 173%;"><span style="font-size:16pt">Cascade</span></font><font color="#010101" face="宋体" size="4" style="line-height: 173%;"><span style="font-size:16pt">与</span></font><font color="#010101" face="Times New Roman" size="4" style="line-height: 173%;"><span style="font-size:16pt">inverse</span></font> <font color="#010101" face="宋体" size="4" style="line-height: 173%;"><span style="font-size:16pt">的区别</span></font></p><ol style="margin-top: 0mm; margin-bottom: 0mm;"><li style="margin-left: 8pt; margin-right: 0pt; padding-left: 0pt; font-family: &amp;apos;Times New Roman&amp;apos;;"><div align="justify"><font color="#010101" face="Times New Roman" style="color: rgb(1, 1, 1);">cascade</font> <font face="宋体"><font color="#010101">描述的是</font><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><b><font color="#3665EE">对象与对象</font></b></span><font color="#010101">之间的关系</font></font></div></li></ol><div align="justify" style="margin-left:15mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="Times New Roman">cascade</font><font color="#010101" face="宋体">和外键没有关系，在</font> <font color="#010101" face="Times New Roman">student</font><font color="#010101" face="宋体">表中，</font><font color="#010101" face="Times New Roman">sid</font> <font color="#010101" face="宋体">、</font><font color="#010101" face="Times New Roman">name</font><font color="#010101" face="宋体">、</font> <font color="#010101" face="Times New Roman">description</font><font color="#010101" face="宋体">和</font><font color="#010101" face="Times New Roman">cascade</font> <font color="#010101" face="宋体">有关系，但是</font> <font color="#010101" face="Times New Roman">cid</font><font color="#010101" face="宋体">和</font><font color="#010101" face="Times New Roman">cascade</font> <font color="#010101" face="宋体">没有关系。</font></div><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm;"><li style="margin-left: 8pt; margin-right: 0pt; padding-left: 0pt; font-family: &amp;apos;Times New Roman&amp;apos;;"><div align="justify"><font color="#010101" face="Times New Roman" style="color: rgb(1, 1, 1);">inverse</font> <font face="宋体"><font color="#010101">描述的是</font><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><font color="#3665EE">对象与外键之间</font></b><font color="#010101">的关系</font></font></div></li></ol><div align="justify" style="margin-left:15mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="Times New Roman">inverse</font><font color="#010101" face="宋体">只和</font> <font color="#010101" face="Times New Roman">cid</font><font color="#010101" face="宋体">有关系，如果维护，则发出</font> <font color="#010101" face="Times New Roman">update</font><font color="#010101" face="宋体">语句</font><font color="#010101" face="Times New Roman">(</font> <font color="#010101" face="宋体">更新外键的</font> <font color="#010101" face="Times New Roman">sql</font><font color="#010101" face="宋体">语句</font><font color="#010101" face="Times New Roman">)</font> <font color="#010101" face="宋体">，如果不维护，则不管。</font></div><hr/></div><div>知识大总结：</div><div align="justify"><font color="#010101" face="Times New Roman">    1</font><font color="#010101" face="宋体">、一对多指的是类与集合的关系</font></div><div align="justify"><font color="#010101" face="Times New Roman">    2</font> <font color="#010101" face="宋体">、多对一指的是类与类的关系</font></div><div align="justify"><font color="#010101" face="Times New Roman">    3</font> <font color="#010101" face="宋体">、多对多指的是类与集合的关系</font></div><div align="justify"><font color="#010101" face="Times New Roman">    4</font> <font color="#010101" face="宋体">、一对多的情况下，多的一方维护效率比较高</font></div><div align="justify"><font color="#010101" face="Times New Roman">    5</font> <font color="#010101" face="宋体">、一对多的情况下，维护关系指的是对外键进行</font> <font color="#010101" face="Times New Roman">update</font><font color="#010101" face="宋体">操作（一的一方维护关系）</font></div><div align="justify"><font color="#010101" face="Times New Roman">         </font> <font color="#010101" face="宋体">多的一方维护关系，只是对多的一方进行所有的属性进行操作</font></div><div align="justify"><font color="#010101" face="Times New Roman">    6</font> <font color="#010101" face="宋体">、多对多维护关系</font></div><div align="justify"><font color="#010101" face="Times New Roman">         </font> <font color="#010101" face="宋体">建立关系</font></div><div align="justify"><font color="#010101" face="Times New Roman">              </font> <font color="#010101" face="宋体">在第三张表中插入一行数据</font></div><div align="justify"><font color="#010101" face="Times New Roman">         </font> <font color="#010101" face="宋体">解除关系</font></div><div align="justify"><font color="#010101" face="Times New Roman">              </font> <font color="#010101" face="宋体">在第三张表中删除一行数据</font></div><div align="justify"><font color="#010101" face="Times New Roman">         </font> <font color="#010101" face="宋体">重新建立关系</font></div><div align="justify"><font color="#010101" face="Times New Roman">              </font> <font color="#010101" face="宋体">先删除后增加</font></div><div align="justify"><font color="#010101" face="Times New Roman">    7</font> <font color="#010101" face="宋体">、因为多对多谁维护关系效率都一样，所以在映射文件中不需要写</font> <font color="#010101" face="Times New Roman">inverse</font><font color="#010101" face="宋体">属性</font></div><div align="justify"><font color="#010101" face="Times New Roman">    8</font> <font color="#010101" face="宋体">、一般情况下一对多，在一的一方</font> <font color="#010101" face="Times New Roman">inverse</font><font color="#010101" face="宋体">属性设置为</font><font color="#010101" face="Times New Roman">&quot;true&quot;</font></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div>  9、List&lt;Course&gt; courses = session .createQuery( &quot;from Course where cid in(2,3)&quot;).list() ;</div><div><br/></div><div> 10、</div><div>  <img src="04关系部分_files/Image.png" type="image/png" style="cursor: default;"/></div><hr/>
包括一对多单向、一对多双项、多对多双向。
<hr/><div><div align="justify" style="font-size: 24px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><font color="#010101" face="宋体">从映射文件可以看出</font> <font color="#010101" face="Times New Roman">,set</font><font color="#010101" face="宋体">元素描述了两个方面的内容：</font></b></div><ol style="margin-top: 0mm; margin-bottom: 0mm;"><li style="margin-left: 25pt; margin-right: 0pt; padding-left: 0pt; font-family: &amp;amp;amp;amp;amp;amp;apos;Times New Roman&amp;amp;amp;amp;amp;amp;apos;; color: rgb(1, 1, 1); font-size: 24px;"><div align="justify"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><font color="#010101" face="Times New Roman">key</font> <font color="#010101" face="宋体">从外键的角度描述了两者之间的关系，用于生成</font> <font color="#010101" face="Times New Roman">sql</font><font color="#010101" face="宋体">语句</font></b></div></li><li style="margin-left: 25pt; margin-right: 0pt; padding-left: 0pt; font-family: Times New Roman; color: #010101;"><div align="justify" style="font-size: 24px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><font color="#010101" face="Times New Roman">one-to-many</font> <font color="#010101" face="宋体">从类与类的角度描述了两者的关系，用于客户端的编码</font></b></div></li></ol></div><div><br/></div><div><hr/></div><div><br/></div><div><br/></div><div>首先研究一对多单向：</div><div>把握住两点：首先，对于程序员，要使用对象的思想，去对模型编程。</div><div>其次，对于框架而言，要告诉他表的对应关系。</div><div><br/></div><div align="justify"><font color="#010101"><br/></font></div><div align="justify"><font color="#010101" face="Times New Roman">    1</font> <font color="#010101" face="宋体">、在映射文件中：</font></div><div align="justify"><font color="#010101" face="Times New Roman">              </font> <img src="04关系部分_files/Image [1].png" type="image/png" alt="graphic" border="0" height="36" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="192"/></div><div align="justify"><font color="#010101" face="Times New Roman">              </font> <img src="04关系部分_files/Image [2].png" type="image/png" alt="graphic" border="0" height="37" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="508"/></div><div align="justify"><font color="#010101" face="Times New Roman">    2</font> <font color="#010101" face="宋体">、在代码中，必须建立关联</font></div><div align="justify"><font color="#010101" face="Times New Roman">              </font> <img src="04关系部分_files/Image [3].png" type="image/png" alt="graphic" border="0" height="111" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="548"/></div><div align="justify"><font color="#010101" face="Times New Roman">    3</font> <font color="#010101" face="宋体">、必须显示操作</font> <font color="#010101" face="Times New Roman">classes</font></div><div align="justify"><font color="#010101" face="Times New Roman">              </font> <img src="04关系部分_files/Image [4].png" type="image/png" alt="graphic" border="0" height="30" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="302"/></div><div><br/></div><div><font color="#010101" face="黑体">显示操作</font> <font color="#010101" face="Arial">                                                                              </font></div><div><hr/>
关于<span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;font-size: 64px;"><b>一对多单向</b></span>的映射文件的编写：<img src="04关系部分_files/Image [5].png" type="image/png" height="504" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1333"/></div><div><br/></div><div style="font-size: 24px;"><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">首先，students是set类型的集合，里面放的为student引用。因此，</span></div><div style="font-size: 24px;"><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">应该先描述那个集合，使用&lt;set&gt;标签，指定需要级联操作的属性，也就是在set中设定cascade属性，一般，在一的一方不维护关系，具体原因是，每一次更新班级的时候，如果维护关系，那么就会也维护其下属的多的一方的所有值，太慢。指定外键，用于去描绘另一个表。</span></div><div style="font-size: 24px;"><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">然后在描绘集合中的对象，描绘对象，使用的&lt;one-to-many&gt;这种类型的标签，去描绘类。</span></div><div><br/></div><div><br/></div><hr/><div>详解映射文件，</div><div>该映射文件，包含：</div><div><ol><li>bean到表的映射</li><li>主键的生成策略</li><li>其他非联系属性的与表的对应。</li><li>联系属性的配置。</li></ol></div><div>对于联系型属性的配置，主要是两个属性的配置：级联操作，关系描述。</div><div>级联操作：就是说在程序操作一个表中的数据的时候，同时框架也可以对其他表中的数据进行操作。</div><div>关系描述：就是在执行级联操作的时候，不但能够操作其他的表，还能够用框架完成对这些表之间关系的描述，说白了，就是外键，告知框架，怎样建立外键。</div><div><div align="left"><font color="#3F5FBF" face="Consolas"><br/></font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">cascade属性的作用以及取值（级联操作）</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">     save-update：</font><span style="color: rgb(63, 95, 191); font-family: Consolas;">对classes对象进行save或者update操作的时候，对student进行怎么样(insert或者update)的操作</span></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">                  如果student是一个持久化状态的对象，看副本</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">                              如果和副本不一样，则执行update操作</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">                  如果student是一个临时状态的对象，则执行insert操作</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">     all</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">     delete：</font><span style="color: rgb(63, 95, 191); font-family: Consolas;">在删除班级的同时删除学生</span></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">     null</font></div><hr/><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">inverse  属性的作用以及取值（</font><span style="color: rgb(63, 95, 191); font-family: Consolas;">维护关系）  翻译过来是不维护取值包括默认，true，false等。</span></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">        default/false</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">        true   不维护关系</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">        false  维护关系</font></div><div align="left" style="font-size: 24px;"><font color="#3F5FBF" face="Consolas">                  </font></div></div><div><br/></div><div><hr/></div><div align="left"><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt">首先研究的是级联操作，就是操作一个表，可以级联操作其他的表，这个先不执行关系操作，所谓的关系，就是通过班级，可以找到该班级的所有的学生。</span></font></div><div align="left"><font color="#008080" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true; font-size: 21px;"><u>首先研究级联操作的过程，这个过程中，不涉及关系的描述。必须指定，谁是外键。</u></b></div><div style="font-size: 21px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><u>在一对多的单向中，通过班级来进行对student的配置。</u></b></div><div style="font-size: 21px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><u>执行过程：</u></b></div><div style="font-size: 21px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><u>首先，在代码中把班级除了主键（由框架生成，没有业务逻辑）以外的普通属性，或者是关系属性（set类型的student），封装好，然后，就开始后执行save方法。仅仅是save班级这个domain。</u></b></div><div style="font-size: 21px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><u>然后：框架会根据配置文件，生成相应的表，到了classes类中的set集合类型的属性，提取配置文件中关于set属性的配置，首先，发现他是一个级联操作，并且配置中明确表示，cid是该student的外键，因此，就会把外键在student表中，成为一列，关于cid的值，是由关系完成的，不是级联完成的。因此，先不用管cid的取值。</u></b></div><div style="font-size: 21px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><u><br/></u></b></div><div style="font-size: 21px;"><b style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><u>然后，会把class中set集合中的数据，级联放到student表中去。这就是级联操作。</u></b></div><div><br/></div><div>也就说，这样class中用student，就会级联操作student表。这个已经在映射文件中，指定。</div><div><br/></div><div><img src="04关系部分_files/Image [6].png" type="image/png" height="217" style="cursor: default;cursor: default;cursor: default;" width="1247"/></div><div><hr/></div><div>delete操作：</div><div>在代码中，我们书写的是：</div><div><br/></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">Classes classes= (Classes)</span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:14pt"><i>session</i></span></font><font face="Consolas" size="4"><span style="font-size:14pt">.get(Classes.</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>class</b></span></font><font face="Consolas" size="4"><span style="font-size:14pt">, 1);</span></font></div><div align="left"><font color="#0000C0" face="Consolas" size="4"><span style="font-size:14pt"><i>session</i></span></font><font face="Consolas" size="4"><span style="font-size:14pt">.delete(classes);（显示操作）</span></font></div><div><br/></div><div>而框架实际执行的sql语句为：</div><div><hr/>
第一步，从数据库中获取班级，<span style="font-family: Consolas; text-align: -webkit-left;">这个是get（班级）方法对应的语句。目的是获得这个班级</span></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt"> </span></font><span style="font-size: 14pt; font-family: Consolas;">Hibernate:</span></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    select</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        classes0_.cid as cid0_0_,</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        classes0_.name as name0_0_,</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        classes0_.description as descript3_0_0_</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    from</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        Classes classes0_</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    where</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        classes0_.cid=?</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><font face="Consolas">第二步，获取该班级的所有的学生信息。</font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">Hibernate:</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    select</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        students0_.cid as cid0_1_,</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        students0_.sid as sid1_,</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        students0_.sid as sid1_0_,</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        students0_.name as name1_0_,</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        students0_.description as descript3_1_0_</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    from</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        Student students0_</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    where</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        students0_.cid=?</span></font></div><div align="left"><font face="Consolas">第三步，为了删除，必须先解除关系，也就是设置给一个学生对应的外键为null，这样，就和班级没有关系了。</font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">Hibernate:</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    update</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        Student</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    set</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        cid=null</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    where</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        cid=?</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">第四步：执行删除学生的操作。</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">Hibernate:</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    delete</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    from</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        Student</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    where</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        sid=?</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">第五步：执行删除班级的sql语句操作。</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">Hibernate:</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    delete</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    from</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        Classes</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    where</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        cid=?</span></font></div><div align="left"><hr/>
重点，在使用save-update的级联操作，完成删除，需要在代码中，好好弄弄，这个可以加深你的理解：</div><div align="left"><br/></div><div align="left"><br/></div><div align="left">其实，没有多么高深，在不使用delete的级联操作下，也就是说，框架不会帮我们自动完成关系的解绑，因此，我们要自己手动解绑，也就是让班级的那个set集合为null，这样，班级就和学生没有关系，也就能删除了。</div><div align="left"><br/></div><div align="left">classes.setStudents(null);</div><div align="left">对应的sql语句为：</div><div align="left"><br/></div><div align="left"><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt"> update</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        Student</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    set</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        cid=null</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">    where</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">        cid=?</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">手动完成了关系的解绑。</span></font></div><hr/><br/></div><div align="left">接下来，就是好好研究一下关系。</div><div align="left"><br/></div><div align="left"><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt">inverse  属性的作用以及取值：</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt">      维护关系</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> default/false</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> true   不维护关系</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> false  维护关系</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt">  在这里维护关系指的是发出更新外键的update语句，外键，就是维护关系的关键，通过外键，去和其他表交流。</span></font></div></div><div align="left"><br/></div><div align="left"><br/></div><hr/><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;font-size: 64px;">一对多双向，</span><a href="04关系部分_files/Classes.hbm.xml"><img src="04关系部分_files/fecb4a338379814786fb3392c119857d.png" alt="Classes.hbm.xml"></a><a href="04关系部分_files/Student.hbm.xml"><img src="04关系部分_files/090e0e69dc035bd7c598593a58d06bbb.png" alt="Student.hbm.xml"></a><div>上面研究的是从一出发，去维护关系的，现在，研究从多出发， 去维护和一之间的关系。</div><div><br/></div><div>首先从映射文件出发：</div><div><img src="04关系部分_files/Image [7].png" type="image/png" height="417" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1076"/></div><div><hr/><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;font-size: 64px;"><b>多对多双向：</b></span><a href="04关系部分_files/Course.hbm.xml"><img src="04关系部分_files/77fbdf5d360de186fc9943691901b8ed.png" alt="Course.hbm.xml"></a><a href="04关系部分_files/Student.hbm.xml"><img src="04关系部分_files/1a385e60059d38144b19a3b19c49bf0d.png" alt="Student.hbm.xml"></a></div><div><br/><div align="left"><img src="04关系部分_files/Image [8].png" type="image/png" height="447" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1167"/></div><div align="left"><br/></div><div align="left">映射文件详解：</div><div align="left">例如，course映射文件，有一个set集合，里面放的是student，那么先描述set集合：指定是级联操作，指定要创建的第三张表，指定cid是第三张表的主键。</div><div align="left">接下来，是对集合中的对象，也就是student指定，它对应的多的是student，并且，指定我创建的第三个表，是通过sid找到那个表（student）的。</div><div align="left">同理：</div><div align="left">对于student，也会创建一样的表，然后，也会后自行sid为该表的主键，指定通过第三张表的cid找到course。</div><div align="left">图解如下：</div><div align="left"><br/></div><div align="left"><img src="04关系部分_files/Image [9].png" type="image/png" height="241" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="939"/></div><div align="left">文字表述，首先，从左边出发，将自己的cid作为中间桥梁的外键，然后我可以找到那个many类，通过sid外键找到。</div><div align="left">从右边出发，将自己的sid作为第三张表的外键，然后找到另一个many表，通过cid外键找到。</div><div align="left"><br/></div><div align="left"><br/></div><div align="left">注意，两个many类，都用该使用cascade属性，这样才是双向。</div><div align="left"><br/></div><div align="left"><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt">多对多的关系：</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> *      建立关系</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> *          相当于在第三张表中插入一行记录</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> *      解除关系</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> *          相当于在第三张表中删除一行记录</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> *      重新建立关系</span></font></div><div align="left"><font color="#3F5FBF" face="Consolas" size="4"><span style="font-size:14pt"> *          先删除后增加</span></font></div><hr/><br/></div><div align="left">关于一对多，以及多对多的图解：</div><div align="left"><img src="04关系部分_files/Image [10].png" type="image/png" height="504" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1280"/></div><div align="left">补充，关于一对一，其实就是在一对多的基础上，规定学生表中的外键，也就是班级唯一，就是一对一体现，一个学生，只能参考一个外键。</div><hr/>
小技巧：</div><div><br/></div><div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt; background:#e8f2fe">List&lt;Course&gt; courses =</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:14pt; background:#e8f2fe"><i><u>session</u></i></span></font> <font face="Consolas" size="4"><span style="font-size:14pt; background:#e8f2fe"><u>.createQuery(</u></span></font><font color="#2A00FF" face="Consolas" size="4"><span style="font-size:14pt; background:#e8f2fe"><u>&quot;from Course where cid in(2,3)&quot;</u></span></font><font face="Consolas" size="4"><span style="font-size:14pt; background:#e8f2fe"><u>).list()</u></span> <span style="font-size:14pt; background:#e8f2fe">;</span></font></div><hr/>
一对一：</div><div><img src="04关系部分_files/Image [11].png" type="image/png" height="133" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="559"/><br/><div align="left"><br/></div><div align="left"><br/></div></div></div>
</div></body></html> 