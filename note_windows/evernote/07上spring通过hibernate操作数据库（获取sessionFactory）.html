<html>
<head>
  <title>07上spring通过hibernate操作数据库（获取sessionFactory）</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="5338"/>
<h1>07上spring通过hibernate操作数据库（获取sessionFactory）</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/8/15 14:32</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/8/18 21:25</i></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div>注意，什么是sessionfactory，他就是表述的一个关于hibernate的各种配置信息的一个类，他包括本次数据库连接中，密码，驱动，以及对hibernate各种设置的各个信息的类。</div><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image.png" type="image/png" style="cursor: default;"/></div><div><hr/>
因为在spring的规则中，如果想要某一个类的实例，就必须指定产生类，并且通过依赖注入（DI）的方式，给产生类赋予相应的值。当时，在hibernate提供的实现类中，没有提供setter方法，或者构造器方法，因此，spring就自己弄了一和SessionFactory类功能一样，并且提供了setter方法的牛类（这叫做学会变通。）</div><div>该类，就是<img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [1].png" type="image/png" height="23" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1038"/></div><div>在其父类中：</div><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [2].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>这样，就符合了spring的规则</div><div><br/></div><div>有了产生类，如果在可以DI，就能够获得实例SessionFactory的实例了。</div><div>两种方式完成DI</div><div>一个是注入全部的配置文件，给spring弄出的牛类。</div><div><br/></div><div>一个分别注入</div><div>DataSource代表基本环境、</div><div>某一个包及其自包的下的映射文件、</div><div>一些全局配置</div><div>完成上面三个，DI给牛类，就可以获得SessionFactory实例了。</div><div><br/></div><hr/><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [3].png" type="image/png" height="373" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1010"/></div><div><hr/></div><div style="font-size: 32px;"><b style="background-color: rgb(255, 250, 165);"><font color="#2D4FC9">获取sessionfactory的两种方式：</font></b></div><div style="font-size: 32px;"><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><b>方式一：</b></span></div><div><br/></div><div>上图可以看出，获取sessionfactory，只要获得hibernate的配置文件，就可以。因此，方式一就是采用这个配置的。也就是下图中，红色线，圈住的，hibernate的配置文件，被hibernate加载，然后，就可以获得sessionfactory。不必传递数据源。<br/><div><br/></div><div><br/></div><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [4].png" type="image/png" height="89" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1207"/></div><div><br/></div><div>方式一注解：sessionfactory是由sessionfactoryImpl这个类来生成的。但是，该类没有依赖注入（注入hibernate的配置文件，通过 <i style="font-size: 14pt; color: rgb(42, 0, 255); font-family: Consolas;">configLocation</i>属性，），不符合spring类的特点，因此，他自己弄了一个类：叫做：<span style="background-color: rgb(212, 212, 212); font-size: 14pt; font-family: Consolas;">LocalSessionFactoryBean。</span></div><div><hr/><div><b style="font-size: 32px;"><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">方式二</span>：</b></div></div><div><br/></div><div>sessionfactory的产生，本来是hibernate的sessionfactoryImpl类，来实现，现在，交给spring，就应该把对hibernate的各个配置，告诉spring，该方式，是将配置文件分离，分为环境类型（DataSource），映射文件，配置文件，因此，会使用以下的配置：</div><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [5].png" type="image/png" height="533" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1335"/></div><div><br/></div><div><br/></div><div><br/></div><div>上述方式表明，通过spring自创的类，来获得sessionfactory实例，而不是由hibernate来完成创建工作。</div><div><br/></div><div>完成之后，只要在客户端，启动容器，就能够获得SessionFactory。</div><hr/>
接下来，就是实实在在与hibernate结合了，在获得SessionFactory（会创建表结构）之后，就可以获得session，然后，就可以执行save等等按照对象的方式，操作数据库的快感了。</div><hr/>
在获得SessionFactory之后，还要有开启事务，这一个事件：
<div>配置文件如下：</div><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [6].png" type="image/png" style="cursor: default;"/></div><div><br/></div><div><p align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.57mm; margin-bottom:4.57mm;line-height: 173%;"><font color="#010101" face="宋体">关于</font><font color="#010101" face="Times New Roman">session</font></p><div align="justify"><font color="#010101" face="Times New Roman">       </font> <font color="#010101" face="宋体">从上图可以看出，程序员使用</font> <font color="#010101" face="Times New Roman">sessionFactory</font><font color="#010101" face="宋体">产生</font><font color="#010101" face="Times New Roman">session</font> <font color="#010101" face="宋体">，从而进行</font> <font color="#010101" face="Times New Roman">crud</font><font color="#010101" face="宋体">的操作</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:8mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="Times New Roman">Spring</font><font color="#010101" face="宋体">容器利用</font> <font color="#010101" face="Times New Roman">sessionFactory</font><font color="#010101" face="宋体">产生</font><font color="#010101" face="Times New Roman">session</font> <font color="#010101" face="宋体">，进行事务的操作，所以</font> <font color="#010101" face="Times New Roman">spring</font><font color="#010101" face="宋体">容器产生</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:8mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">的</font><font color="#010101" face="Times New Roman">session</font> <font color="#010101" face="宋体">和程序员用的</font> <font color="#010101" face="Times New Roman">session</font><font color="#010101" face="宋体">肯定是同一个</font><font color="#010101" face="Times New Roman">session</font><font color="#010101" face="宋体">，所以在</font> <font color="#010101" face="Times New Roman">spring</font><font color="#010101" face="宋体">声明式事务处理的</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:8mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">时候，</font><font color="#010101" face="Times New Roman">session</font> <font color="#010101" face="宋体">必须由当前线程产生。</font></div><div><br/></div><div><hr/>
具体的使用：</div><div><br/></div><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [7].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>类似于JDBC，也是有模板类，只要传递SessionFactory（类似于传递DataSource），就可以使模板类工作了。<br/><div><img src="07上spring通过hibernate操作数据库（获取sessionFactory）_files/Image [8].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div><br/></div><div><hr/>
在以后，不管是使用jdbc，还是hibernate，都可以使用模板中的方法，只要注入相应的数据（一般是一个类的实例）</div><div><br/></div></div></div></div>
</div></body></html> 