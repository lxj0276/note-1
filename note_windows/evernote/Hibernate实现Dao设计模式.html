<html>
<head>
  <title>Hibernate实现Dao设计模式</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="1602"/>
<h1>Hibernate实现Dao设计模式</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/7/21 20:17</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/7/21 22:03</i></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><span style="font-size: 32px;"><img src="Hibernate实现Dao设计模式_files/DAO模型.jpg" type="image/jpeg" style="cursor: default;"/></span><div style="font-size: 21px;"><div><span style="font-size: 32px;">一、首先配环境：</span></div></div><div style="font-size: 21px;">参考基础加强中的笔记</div><div style="font-size: 32px;">二、写代码：</div><div style="font-size: 24px;">创建数据库：</div><div style="font-size: 32px;"><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">/*</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">create database day22;</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">use day22;</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">create table person(</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">     id</span> <span style="font-size:14pt"><u>int</u></span> <span style="font-size:14pt">primary key auto_increment,</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">     name</span> <span style="font-size:14pt"><u>varchar</u></span><span style="font-size:14pt">(100),</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">     birthday date</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">);</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt"> */</span></font></div></div><div style="font-size: 21px;">1、Hibernate工具类，用于生产Hibernate的Session对象。</div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/HibernateUtil.java"><img src="Hibernate实现Dao设计模式_files/2abd2b2a82e1ffc776709d683eb10fa5.png" alt="HibernateUtil.java"></a></div><div style="font-size: 21px;">2、写domain，及其映射文件</div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/Customer.java"><img src="Hibernate实现Dao设计模式_files/d0d4cfe5c193524f1601ee2b419228f2.png" alt="Customer.java"></a></div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/Person.java"><img src="Hibernate实现Dao设计模式_files/d2e0fba504380e0c299dd4f66d0a9d4b.png" alt="Person.java"></a></div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/Customer.hbm.xml"><img src="Hibernate实现Dao设计模式_files/c80482f6c36b1f186c2511aae3c17202.png" alt="Customer.hbm.xml"></a></div><div style="font-size: 21px;">3、写dao层，抽出一个公共BaseDao接口</div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/Dao.java"><img src="Hibernate实现Dao设计模式_files/0b7ab3e436b7d1b961446d682bc9d432.png" alt="Dao.java"></a></div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/CustomerDao.java"><img src="Hibernate实现Dao设计模式_files/4a4ad1c51cfa72813f16b58b4711e16d.png" alt="CustomerDao.java"></a></div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/PersonDao.java"><img src="Hibernate实现Dao设计模式_files/ab0fb8982397c1101cb5458f4d7449ba.png" alt="PersonDao.java"></a></div><div style="font-size: 21px;"><a href="Hibernate实现Dao设计模式_files/Person.hbm.xml"><img src="Hibernate实现Dao设计模式_files/51f10f61a16da18c69891ff6607a8617.png" alt="Person.hbm.xml"></a></div><div style="font-size: 21px;"><div>4、写dao的实现层，抽出一个公共BaseDaoImpl类</div><div><a href="Hibernate实现Dao设计模式_files/BaseDao.java"><img src="Hibernate实现Dao设计模式_files/f325a4d4bd0fb8c20b3175ad334bed0e.png" alt="BaseDao.java"></a></div><div><a href="Hibernate实现Dao设计模式_files/CustomerDaoImpl.java"><img src="Hibernate实现Dao设计模式_files/b90d1ccbe2d561cf96af96d4a9ae6304.png" alt="CustomerDaoImpl.java"></a></div><div><a href="Hibernate实现Dao设计模式_files/PersonDaoImpl.java"><img src="Hibernate实现Dao设计模式_files/940be6d0492403ca49f20f86995caf96.png" alt="PersonDaoImpl.java"></a></div><div>---------------------------BaseDaoImpl类--------------------------------------------------</div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>import</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">java.io.Serializable;</span></font></div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>import</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">java.lang.reflect.ParameterizedType;</span></font></div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>import</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">java.lang.reflect.Type;</span></font></div><div align="left"><font color="#010101" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>import</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">org.hibernate.Session;</span></font></div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>import</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">org.hibernate.Transaction;</span></font></div><div align="left"><font color="#010101" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>import</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">com.itheima.dao.Dao;</span></font></div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>import</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">com.itheima.util.HibernateUtil;</span></font></div><div align="left"><font color="#010101" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>abstract</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>class</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">BaseDao&lt;T&gt;</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>implements</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">Dao&lt;T&gt; {</span></font></div><div align="left"><font color="#010101" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>private</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">Class&lt;T&gt;</span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:14pt">clazz</span></font><font face="Consolas" size="4"><span style="font-size:14pt">;</span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//具体的实体类</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">BaseDao(){</span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//泛型的反射</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//必须知道具体操作的是哪个类。给</span> <span style="font-size:14pt"><u>clazz</u></span><span style="font-size:14pt">赋值</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//System.out.println(this);//com.itheima.dao.impl.PersonDaoImpl@3f57fb52</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Type type =</span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>this</b></span></font><font face="Consolas" size="4"><span style="font-size:14pt">.getClass().getGenericSuperclass();</span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//得到当前对象的带有泛型信息的父类型  BaseDao&lt;Person&gt;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          ParameterizedType pType = (ParameterizedType)type;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#0000C0" face="Consolas" size="4"><span style="font-size:14pt">clazz</span></font> <font face="Consolas" size="4"><span style="font-size:14pt">=</span> <span style="font-size:14pt"><u>(Class&lt;T&gt;)pType.getActualTypeArguments()[0]</u></span><span style="font-size:14pt">;</span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//得到实际的参数泛型类型  Person</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     }</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">/*</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">      * 比较麻烦的一种得到</span> <span style="font-size:14pt"><u>clazz</u></span><span style="font-size:14pt">的做法</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">      * private Class</span> <span style="font-size:14pt"><u>clazz</u></span><span style="font-size:14pt">;//具体的实体类</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">     public BaseDao(Class</span> <span style="font-size:14pt"><u>clazz</u></span><span style="font-size:14pt">){</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">          this.clazz =</span> <span style="font-size:14pt"><u>clazz</u></span><span style="font-size:14pt">;</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">     }*/</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>void</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">add(T t) {</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Session s = HibernateUtil.</span> <span style="font-size:14pt"><i>getSession</i></span><span style="font-size:14pt">();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//开启事务</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Transaction tx = s.beginTransaction();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          s.save(t);</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//提交事务</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          tx.commit();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#3F7F5F" face="Consolas" size="4"><span style="font-size:14pt">//关闭Session</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          s.close();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     }</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>public</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">T findOne(Serializable pk) {</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Session s = HibernateUtil.</span> <span style="font-size:14pt"><i>getSession</i></span><span style="font-size:14pt">();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          T bean =</span> <span style="font-size:14pt"><u>(T)s.get(</u></span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:14pt"><u>clazz</u></span></font><font face="Consolas" size="4"><span style="font-size:14pt"><u>, pk)</u></span><span style="font-size:14pt">;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          s.close();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          </span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>return</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">bean;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     }</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>void</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">update(T t) {</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Session s = HibernateUtil.</span> <span style="font-size:14pt"><i>getSession</i></span><span style="font-size:14pt">();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Transaction tx = s.beginTransaction();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          s.update(t);</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          tx.commit();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          s.close();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas" size="4"><span style="font-size:14pt"><br/></span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     </span></font><font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas" size="4"><span style="font-size:14pt"><b>void</b></span></font> <font face="Consolas" size="4"><span style="font-size:14pt">del(Serializable pk) {</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Session s = HibernateUtil.</span> <span style="font-size:14pt"><i>getSession</i></span><span style="font-size:14pt">();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          Transaction tx = s.beginTransaction();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          T obj =</span> <span style="font-size:14pt"><u>(T)s.get(</u></span></font><font color="#0000C0" face="Consolas" size="4"><span style="font-size:14pt"><u>clazz</u></span></font><font face="Consolas" size="4"><span style="font-size:14pt"><u>, pk)</u></span><span style="font-size:14pt">;</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          s.delete(obj);</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          tx.commit();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">          s.close();</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">     }</span></font></div><div align="left"><font face="Consolas" size="4"><span style="font-size:14pt">}</span></font></div></div></div>
</div></body></html> 