<html>
<head>
  <title>动态代理的说明</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="583"/>
<h1>动态代理的说明</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/7/15 13:35</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/7/26 9:06</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="file:///"><i>file:///</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left"><font color="#7F0055" face="Consolas" size="4"><b>一、动态代理简介：</b></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">Boss {</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">main(String[] args) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>final</b></span></font> <font face="Consolas"><span style="font-size:12pt">Human h =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">SpringBrothder();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//原有对象</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//动态代理</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">/*</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">            * newProxyInstance(ClassLoader loader,</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                                      Class&lt;?&gt;[] interfaces,</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                                      InvocationHandler h);</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">            ClassLoader loader:代理类需要用到的类加载器。和被代理对象使用相同的加载器即可</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">            Class&lt;?&gt;[] interfaces:代理类需要实现的接口。固定写法</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">            InvocationHandler h:策略设计模式。</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">            */</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Human proxyMan = (Human)Proxy.</span><span style="font-size:12pt"><i>newProxyInstance</i></span><span style="font-size:12pt">(h.getClass().getClassLoader(), h.getClass().getInterfaces(),</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">InvocationHandler() {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//调用代理类的任何方法都会执行该方法</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">/*</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                            Object invoke(Object</span> <span style="font-size:12pt"><u>proxy</u></span><span style="font-size:12pt">, Method method, Object[]</span> <span style="font-size:12pt"><u>args</u></span><span style="font-size:12pt">)</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                            Object</span> <span style="font-size:12pt"><u>proxy</u></span><span style="font-size:12pt">:对代理对象的引用</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                            method：当前执行的方法对象。</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                           </span> <span style="font-size:12pt"><u>args</u></span><span style="font-size:12pt">：当前方法用到的参数</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                           </span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                            返回值：当前方法执行的返回值</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                           </span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">                            */</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">Object invoke(Object proxy, Method</span> <span style="font-size:12pt; background:#f0d8a8">method</span><span style="font-size:12pt">, Object[] args)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">Throwable {</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//                              System.out.println(&quot;执行了&quot;);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;single&quot;</span></font><font face="Consolas"><span style="font-size:12pt">.equals(</span> <span style="font-size:12pt; background:#d4d4d4">method</span><span style="font-size:12pt">.getName())){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>float</b></span></font> <font face="Consolas"><span style="font-size:12pt">money = (Float)args[0];</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(money&gt;10000){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//才去唱歌</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt; background:#d4d4d4">method</span><span style="font-size:12pt">.invoke(h, money/2);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>else</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;dance&quot;</span></font><font face="Consolas"><span style="font-size:12pt">.equals(</span> <span style="font-size:12pt; background:#d4d4d4">method</span><span style="font-size:12pt">.getName())){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>float</b></span></font> <font face="Consolas"><span style="font-size:12pt">money = (Float)args[0];</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(money&gt;20000){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//才去跳舞</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt; background:#d4d4d4">method</span><span style="font-size:12pt">.invoke(h, money/2);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>else</b></span></font><font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt; background:#d4d4d4">method</span><span style="font-size:12pt">.invoke(h, args);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     });</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           proxyMan.single(20000);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           proxyMan.dance(30000);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           proxyMan.eat();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><div style="text-align: -webkit-auto; font-size: 14px;"><font face="Times New Roman"><font color="#FF0000">二、  基于接口的动态代理：</font>被代理对象最少实现了一个接口。</font></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;">     用Proxy.newProxyInstance(Classloader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h);</span></font></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;">      </span></font></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;">     代码如下：代理类来控制</span></font></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;">   </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">BeanFactory {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font face="Consolas"><span style="font-size:12pt">BusinessService getBusinessService(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>final</b></span></font> <font face="Consolas"><span style="font-size:12pt">String includeMethods[] = {</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;transfer&quot;</span></font><font face="Consolas"><span style="font-size:12pt">};</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//写到配置文件中</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>final</b></span></font> <font face="Consolas"><span style="font-size:12pt">BusinessService</span> <span style="font-size:12pt; background:#f0d8a8">s</span> <span style="font-size:12pt">=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">BusinessServiceImpl();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//AOP</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           BusinessService proxyS = (BusinessService)Proxy.</span><span style="font-size:12pt"><i>newProxyInstance</i></span><span style="font-size:12pt">(</span><span style="font-size:12pt; background:#d4d4d4">s</span> <span style="font-size:12pt">.getClass().getClassLoader(),</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span> <span style="font-size:12pt; background:#d4d4d4">s</span><span style="font-size:12pt">.getClass().getInterfaces(),</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">InvocationHandler() {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font face="Consolas"><span style="font-size:12pt">Object invoke(Object proxy, Method method, Object[] args)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">Throwable {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font><font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>boolean</b></span></font> <font face="Consolas"><span style="font-size:12pt">needInterceptor =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>false</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(String methodName:includeMethods){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                          </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(method.getName().equals(methodName)){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                                needInterceptor =</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>true</b></span></font><font face="Consolas"><span style="font-size:12pt">;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(needInterceptor){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>long</b></span></font> <font face="Consolas"><span style="font-size:12pt">time = System.</span><span style="font-size:12pt"><i>currentTimeMillis</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                          TransactionManager.</span> <span style="font-size:12pt"><i>startTransaction</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           Object rtValue = method.invoke(</span><span style="font-size:12pt; background:#d4d4d4">s</span><span style="font-size:12pt">, args);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                          TransactionManager.</span> <span style="font-size:12pt"><i>commit</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                          System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(method.getName()+</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;用时：&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+(System.</span><span style="font-size:12pt"><i>currentTimeMillis</i></span><span style="font-size:12pt">()-time)+</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;毫秒&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">rtValue;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>else</b></span></font><font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">method.invoke(</span><span style="font-size:12pt; background:#d4d4d4">s</span><span style="font-size:12pt">, args);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font><font face="Consolas"><span style="font-size:12pt">(Exception e){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     TransactionManager.</span> <span style="font-size:12pt"><i>rollback</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throw</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">RuntimeException(e);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>finally</b></span></font><font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                     TransactionManager.</span> <span style="font-size:12pt"><i>release</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           });</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">proxyS;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div style="text-align: -webkit-auto;"><div><span style="font-family: 'Times New Roman'; font-size: 14px;"><font color="#FF0000">  c.1  基于子类的动态代理：</font>代理类是被代理类的子类。需要用到</span><span style="font-family: 'Times New Roman'; font-size: 19px;">CGLIB，用到</span><a href="动态代理的说明_files/cglib-nodep-2.1_3.jar"><img src="动态代理的说明_files/060403a24048eb5ce54a8fe6537fb607.png" alt="cglib-nodep-2.1_3.jar"></a>包。</div></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;"><br/></span></font></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;">  代码如下：</span></font></div><div style="text-align: -webkit-auto;"><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>public</b></span></font><font face="Consolas"> </font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>class</b></span></font> <font face="Consolas"><span style="font-size: 12pt;">ArtistMan {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     </span></font><font color="#7F0055" face="Consolas"> <span style="font-size: 12pt;"><b>public</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>void</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> sing(</span></font><font color="#7F0055" face="Consolas"> <span style="font-size: 12pt;"><b>float</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> money) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size: 12pt;"><i>out</i></span></font><font face="Consolas"><span style="font-size: 12pt;">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size: 12pt;">&quot;收到：&quot;</span></font><font face="Consolas"> <span style="font-size: 12pt;">+money +</span></font><font color="#2A00FF" face="Consolas"><span style="font-size: 12pt;">&quot;开始唱歌&quot;</span></font> <font face="Consolas"><span style="font-size: 12pt;">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size: 12pt;"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     </span></font><font color="#7F0055" face="Consolas"> <span style="font-size: 12pt;"><b>public</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>void</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> dance(</span></font><font color="#7F0055" face="Consolas"> <span style="font-size: 12pt;"><b>float</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> money) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size: 12pt;"><i>out</i></span></font><font face="Consolas"><span style="font-size: 12pt;">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size: 12pt;">&quot;收到：&quot;</span></font><font face="Consolas"> <span style="font-size: 12pt;">+money +</span></font><font color="#2A00FF" face="Consolas"><span style="font-size: 12pt;">&quot;开始跳舞&quot;</span></font> <font face="Consolas"><span style="font-size: 12pt;">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     }</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size: 12pt;"><br/></span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     </span></font><font color="#7F0055" face="Consolas"> <span style="font-size: 12pt;"><b>public</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>void</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> eat() {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size: 12pt;"><i>out</i></span></font><font face="Consolas"><span style="font-size: 12pt;">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size: 12pt;">&quot;开始吃饭&quot;</span></font><font face="Consolas"> <span style="font-size: 12pt;">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">}</span></font></div></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;"><br/></span></font></div><div style="text-align: -webkit-auto;"><font face="Times New Roman"><span style="font-size: 14px;">   </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>public</b></span></font><font face="Consolas"> </font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>class</b></span></font> <font face="Consolas"><span style="font-size: 12pt;">Boss2 </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>extends</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> ArtistMan {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     </span></font><font color="#7F0055" face="Consolas"> <span style="font-size: 12pt;"><b>public</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>static</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>void</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> main(String[] args) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>final</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> ArtistMan man = </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>new</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> ArtistMan();</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">            ArtistMan proxyMan = (ArtistMan) Enhancer.</span><span style="font-size: 12pt;"><i>create</i></span><span style="font-size: 12pt;">(ArtistMan.</span></font><font color="#7F0055" face="Consolas"> <span style="font-size: 12pt;"><b>class</b></span></font><font face="Consolas"><span style="font-size: 12pt;">, </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>new</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> MethodInterceptor() {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                </span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>public</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> Object intercept(Object proxy, Method method, Object[] args,</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                           MethodProxy arg3) </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>throws</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> Throwable {</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                     </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>if</b></span></font><font face="Consolas"><span style="font-size: 12pt;">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size: 12pt;">&quot;sing&quot;</span></font><font face="Consolas"><span style="font-size: 12pt;">.equals(method.getName())){</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>float</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> money = (Float) args[0];</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>return</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> method.invoke(man, money/2);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                     }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>else</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> </span></font><font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>if</b></span></font><font face="Consolas"><span style="font-size: 12pt;">(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size: 12pt;">&quot;dance&quot;</span></font><font face="Consolas"><span style="font-size: 12pt;">.equals(method.getName())){</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>float</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> money = (Float) args[0];</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>return</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> method.invoke(man, money);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                     }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>else</b></span></font><font face="Consolas"><span style="font-size: 12pt;">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size: 12pt;"><b>return</b></span></font><font face="Consolas"><span style="font-size: 12pt;"> method.invoke(man, args);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           });</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           proxyMan.sing(200);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           proxyMan.dance(300);</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">           proxyMan.eat();</span></font></div><div align="left"><font face="Consolas"><span style="font-size: 12pt;">     }</span></font></div><div align="left"><font face="Consolas"><font size="4">}</font></font></div></div></div>
</div></body></html> 