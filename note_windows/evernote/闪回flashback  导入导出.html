<html>
<head>
  <title>闪回flashback  导入导出</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="7415"/>
<h1>闪回flashback  导入导出</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/9/19 19:12</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/9/21 1:37</i></td></tr>
<tr><td><b>标签：</b></td><td><i>oracle, 导入导出, 闪回</i></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">在Oracle中任何一个操作都是可撤销的</span></div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">1.闪回的概念</span><div><br/></div><div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">2.闪回的类型：</span></div><div>·2.1.闪回表：将表回退到过去的一个时间上--&gt;解决：错误地删除了数据，并且commit。</div><div>·2.2.闪回删除：操作Oracle的回收站 --&gt;解决：错误地删除了表，drop table</div><div>·2.3.闪回版本查询：表上的历史记录(只要记录被commit过) --&gt;解决：如何获取表上的历史记录</div><div>·2.4.闪回事务查询：获取一个undo_sql，通过undo_sql来撤销一个事物。--&gt;j解决：如何撤销一个已经提交了的事务。</div><div>·2.5.闪回数据库：将数据库回退到过去的一个时间上</div><div>·2.6.闪回归档日志。</div><div><br/></div><div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">3.当容量大于默认的2G时，可以闪回900s内的信息.</span></div><div>实现表的闪回，需要使用到与撤销表空间相关的undo信息，通过show parameter undo命令可以了解这些信息。</div><div><img src="闪回flashback  导入导出_files/Image.png" type="image/png" height="470" style="cursor: default;cursor: default;cursor: default;" width="544"/></div><div>scope取值中的memoery指值修改当前数据库，不改参数设置</div><div>                    spfile只改参数设置，不修改当前数据库，重启后才有效。</div><div><br/></div><div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">4.闪回表</span></div><div>4.1闪回表，闪回删除语法：</div><div><img src="闪回flashback  导入导出_files/Image [1].png" type="image/png" height="330" style="cursor: default;cursor: default;" width="592"/></div><div>闪回表需要将表的行移动功能打开：</div><div>     alter table &lt;table_name&gt; enable row movement;</div><div><br/></div><div>通过timestamp闪回表<br/><br/>
通过SCN号闪回表</div><div><br/></div><div><span>4.2.闪回表: 需要考虑的事情</span></div><div>FLASHBACK TABLE命令作为单一的事务执行，会得到一个单一的DML锁<br/>
表的统计数据不会被闪回<br/>
当前的索引和从属的对象会被维持<br/>
闪回表操作:<br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>系统表不能被闪回</div><div>不能跨越DDL操作</div><div>会被写入警告日志</div><div>产生撤销和重做的数据</div></blockquote><div><br/></div><div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">5.闪回删除:只对普通用户有效。</span></div><div>回收站只对表有效</div><div>管理员没有回收站，删除的数据就直接删除了</div><div>回收站重命名的规则：BIN$globalUID$version。其中： BIN表示RECYCLEBIN；globalUID是一个全局唯一的、24个字非长的对象，该标识与原对象名没有任何关系；version指数据库分配的版本号。</div><div><br/></div><div>闪回删除对下列表无效:<br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>在SYSTEM 表空间内的表</div><div>用精细审计的数据库或 虚拟的私人数据库</div><div>属于字典管理的表空间</div><div>由于空间不足已经被手动或自动删除的表</div></blockquote><div>以下依赖不被保护:<br/></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>位图索引</div><div>表之前删掉的索引</div></blockquote><div><br/></div><div>闪回删除第一种方式：注意重名对象。</div><div><img src="闪回flashback  导入导出_files/Image [2].png" type="image/png" height="212" style="cursor: default;cursor: default;" width="595"/></div><div>闪回删除第二种方式：</div><div><img src="闪回flashback  导入导出_files/Image [3].png" type="image/png" height="147" style="cursor: default;cursor: default;" width="617"/></div><div><br/></div><div><img src="闪回flashback  导入导出_files/Image [4].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br/></div><div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">6.闪回版本查询</span></div><div>提供了一个审计行改变的查询功能</div><div>语法：</div><div><img src="闪回flashback  导入导出_files/Image [5].png" type="image/png" style="cursor: default;cursor: default;"/></div>
其中：column_name列名；table_name表名；between...and时间段；SCN系统改变号；TIMESTAMP时间戳；AS OF表示恢复单个版本;MAXVALUE最大值；MINVALUE最小值；expr指定一个值或者表达式。<br/><div>     </div><div><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;">7.返回事务查询</span></div><div>闪回事务查询实际上闪回版本查询的一个扩充，通过它可以审计某个事务甚至撤销一个已经提交的事务。<br/></div><div><br/></div><div>实现闪回事务查询，需要先了解flashback_transaction_query视图，从该视图中可以获取事务的历史操作记录以及撤销语句(UNDO_SQL)。</div><div>要查询flashback_transaction_query视图的信息，需要有select any transaction的权限。<br/></div><div><img src="闪回flashback  导入导出_files/Image [6].png" type="image/png" height="384" style="cursor: default;cursor: default;" width="568"/></div><div><br/></div><div>步骤：</div><div>     从闪回版本查询中，获取xid号。<br/>
     基于xid号，在flashback_transaction_query视图中获取相应事务的信息。<br/>
     利用UNDO_SQL撤销事务操作。<br/></div><div><img src="闪回flashback  导入导出_files/Image [7].png" type="image/png" height="652" style="cursor: default;cursor: default;" width="708"/></div><div><br/></div><div><br/></div><div style="font-size: 24px;"><span style="background-color:rgb(255, 250, 165);-evernote-highlight:true;"><b>二。导入导出</b></span></div><div>在Oracle中备用用：</div><div><img src="闪回flashback  导入导出_files/Image [8].png" type="image/png" style="cursor: default;cursor: default;"/></div><div>exp和imp可以看成轻量级的备份</div><div>exp --help</div><div><br/></div><div><br/></div><div>1.exp</div><div>格式：<br/>
EXP KEYWORD=value 或 KEYWORD=(value1,value2,...,valueN)<br/></div><div><br/></div><div><img src="闪回flashback  导入导出_files/Image [9].png" type="image/png" height="528" style="cursor: default;" width="895"/></div><div><br/></div><div>2.imp</div><div>格式：<br/>
IMP KEYWORD=value 或 KEYWORD=(value1,value2,...,valueN)<br/></div><div><img src="闪回flashback  导入导出_files/Image [10].png" type="image/png" height="502" style="cursor: default;" width="957"/></div><div><br/></div><div><img src="闪回flashback  导入导出_files/Image [11].png" type="image/png" style="cursor: default;"/></div></div>
</div></body></html> 