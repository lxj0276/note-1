<html>
<head>
  <title>jdcb-4 DBUtil</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="556"/>
<h1>jdcb-4 DBUtil</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/7/15 8:53</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/8/3 10:06</i></td></tr>
<tr><td><b>标签：</b></td><td><i>DBUtil</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="file:///C:/Users/ADMINI~1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html"><i>file:///C:/Users/ADMINI~1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><br/></div><div><span style="font-family: 宋体; font-size: 22pt;">一、</span><font face="Times New Roman" style="font-size: 22pt;">DBUtil</font><font face="宋体" style="font-family: 宋体; font-size: 22pt;">框架提供的各种结果处理</font></div><div><font face="宋体" style="font-family: 宋体; font-size: 22pt;"><br/></font></div><div style="font-size: 19px;"><font face="宋体">     </font><b>org.apache.commons.dbutils.QueryRunner</b></div><div><span style="font-size: 19px;"><b>               构造函数主要有两个：</b></span></div><div><span style="font-size: 19px;"><b>                    </b></span><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#QueryRunner%28%29">QueryRunner</a></b>()</div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;">          </blockquote><font color="#0000EE" face="monospace"><b>          </b></font><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#QueryRunner%28javax.sql.DataSource%29">QueryRunner</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/javax/sql/DataSource.html?is-external=true" title="class or interface in javax.sql">DataSource</a> ds)</code>   ：有数据源的构造函数 </blockquote><div><span style="font-size: 19px;"><b>               主要方法：</b></span></div><div><span style="font-size: 19px;"><b>                    </b></span></div><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code> int[]</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#batch%28java.sql.Connection,%20java.lang.String,%20java.lang.Object[][]%29">batch</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a> conn, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>[][] params)</code><br/>
          Execute a batch of SQL INSERT, UPDATE, or DELETE queries.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code> int[]</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#batch%28java.lang.String,%20java.lang.Object[][]%29">batch</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>[][] params)</code><br/>
          Execute a batch of SQL INSERT, UPDATE, or DELETE queries.</td></tr></tbody></table><div style="font-size: 19px;"><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="white"><td align="right" valign="top" width="1%"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr align="right"><td nowrap="nowrap"><font size="-1"><code>&lt;T&gt; T</code></font></td></tr></tbody></table></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#query%28java.sql.Connection,%20java.lang.String,%20org.apache.commons.dbutils.ResultSetHandler%29">query</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a> conn, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/ResultSetHandler.html" title="interface in org.apache.commons.dbutils">ResultSetHandler</a>&lt;T&gt; rsh)</code><br/>
          Execute an SQL SELECT query without any replacement parameters.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr align="right"><td nowrap="nowrap"><font size="-1"><code>&lt;T&gt; T</code></font></td></tr></tbody></table></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#query%28java.sql.Connection,%20java.lang.String,%20org.apache.commons.dbutils.ResultSetHandler,%20java.lang.Object...%29">query</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a> conn, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/ResultSetHandler.html" title="interface in org.apache.commons.dbutils">ResultSetHandler</a>&lt;T&gt; rsh, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>... params)</code><br/>
          Execute an SQL SELECT query with replacement parameters.</td></tr></tbody></table></div><div><h1 style="margin-bottom:0pt; margin-top:0pt;"></h1><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="white"><td align="right" valign="top" width="1%"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr align="right"><td nowrap="nowrap"><font size="-1"><code>&lt;T&gt; T</code></font></td></tr></tbody></table></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#query%28java.lang.String,%20org.apache.commons.dbutils.ResultSetHandler%29">query</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/ResultSetHandler.html" title="interface in org.apache.commons.dbutils">ResultSetHandler</a>&lt;T&gt; rsh)</code><br/>
          Executes the given SELECT SQL without any replacement parameters.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr align="right"><td nowrap="nowrap"><font size="-1"><code>&lt;T&gt; T</code></font></td></tr></tbody></table></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#query%28java.lang.String,%20org.apache.commons.dbutils.ResultSetHandler,%20java.lang.Object...%29">query</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/ResultSetHandler.html" title="interface in org.apache.commons.dbutils">ResultSetHandler</a>&lt;T&gt; rsh, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>... params)</code><br/>
          Executes the given SELECT SQL query and returns a result object.</td></tr></tbody></table><h1 style="margin-bottom:0pt; margin-top:0pt;"></h1><h1 style="margin-bottom:0pt; margin-top:0pt;"></h1><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code>int</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#update%28java.sql.Connection,%20java.lang.String%29">update</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a> conn, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql)</code><br/>
          Execute an SQL INSERT, UPDATE, or DELETE query without replacement parameters.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code>int</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#update%28java.sql.Connection,%20java.lang.String,%20java.lang.Object...%29">update</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a> conn, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>... params)</code><br/>
          Execute an SQL INSERT, UPDATE, or DELETE query.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code>int</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#update%28java.sql.Connection,%20java.lang.String,%20java.lang.Object%29">update</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a> conn, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a> param)</code><br/>
          Execute an SQL INSERT, UPDATE, or DELETE query with a single replacement parameter.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code>int</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#update%28java.lang.String%29">update</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql)</code><br/>
          Executes the given INSERT, UPDATE, or DELETE SQL statement without any replacement parameters.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code>int</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#update%28java.lang.String,%20java.lang.Object...%29">update</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>... params)</code><br/>
          Executes the given INSERT, UPDATE, or DELETE SQL statement.</td></tr><tr bgcolor="white"><td align="right" valign="top" width="1%"><font size="-1"><code>int</code></font></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#update%28java.lang.String,%20java.lang.Object%29">update</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a> param)</code><br/>
          Executes the given INSERT, UPDATE, or DELETE SQL statement with a single replacement parameter.</td></tr></tbody></table><h1 style="margin-bottom:0pt; margin-top:0pt;"><font face="宋体"><span style="font-size: 29px;"><br/></span></font></h1><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="white"><td align="right" valign="top" width="1%"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr align="right"><td nowrap="nowrap"><font size="-1"><code>&lt;T&gt; T</code></font></td></tr></tbody></table></td><td><code><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/QueryRunner.html#query%28java.sql.Connection,%20java.lang.String,%20org.apache.commons.dbutils.ResultSetHandler,%20java.lang.Object...%29">query</a></b>(<a href="http://download.oracle.com/javase/6/docs/api/java/sql/Connection.html?is-external=true" title="class or interface in java.sql">Connection</a> conn, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> sql, <a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/ResultSetHandler.html" title="interface in org.apache.commons.dbutils">ResultSetHandler</a>&lt;T&gt; rsh, <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>... params)</code></td></tr></tbody></table><div><h1 style="font-size: 32px; margin-bottom: 0pt; margin-top: 0pt;"><font size="3" style="font-size: 19px;"><font face="宋体" style="font-weight: normal;">   </font></font></h1><div><h1 style="font-size: 32px; margin-bottom: 0pt; margin-top: 0pt;"><font size="3" style="font-size: 19px;"><font face="宋体" style="font-weight: normal;">  其中query语句中的</font><span style="font-weight: normal; font-family: monospace; background-color: rgb(255, 255, 255);"> </span><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/ResultSetHandler.html" style="font-weight: normal; font-family: monospace; background-color: rgb(255, 255, 255);" title="interface in org.apache.commons.dbutils">ResultSetHandler</a><span style="font-weight: normal; font-family: monospace; background-color: rgb(255, 255, 255);">&lt;T&gt; rsh用了策略模式，是个接口，要用可以new它的实现类，它的实现类有以下一些：</span></font></h1></div></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>该接口用于处理 java.sql.ResultSet，将数据按要求转换为另一种形式。</div><div>ResultSetHandler 接口提供了一个单独的方法：Object handle (java.sql.ResultSet .rs)。</div></blockquote><div><div style="font-size: 32px;"><h1 style="margin-bottom:0pt; margin-top:0pt;"></h1></div><dl><dt><img src="jdcb-4 DBUtil_files/Image.png" type="image/png" height="268" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="986"/></dt><dd><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><table border="1" cellpadding="3" cellspacing="0" width="100%"><tbody><tr bgcolor="white"><td width="15%"><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/handlers/BeanHandler.html" title="class in org.apache.commons.dbutils.handlers">BeanHandler&lt;T&gt;</a></b></td><td><code>ResultSetHandler</code> implementation that converts the first <code>ResultSet</code> row into a JavaBean.</td></tr><tr bgcolor="white"><td width="15%"><b><a href="file:///C:/Users/ADMINI%7E1/AppData/Local/Temp/Rar$EXa0.387/commons-dbutils-1.4/apidocs/org/apache/commons/dbutils/handlers/BeanListHandler.html" title="class in org.apache.commons.dbutils.handlers">BeanListHandler&lt;T&gt;</a></b></td><td><code>ResultSetHandler</code> implementation that converts a <code>ResultSet</code> into a <code>List</code> of beans.</td></tr></tbody></table></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//DButil中的各种结果处理器</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">ResultSetHandlerDemo {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font face="Consolas"><span style="font-size:12pt">QueryRunner</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">QueryRunner(DBCPUtil.</span><span style="font-size:12pt"><i>getDataSource</i></span><span style="font-size:12pt">());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//ArrayHandler：把结果集中的第一行数据转成对象数组。  Object[] 元素是每列的数据</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Test</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">test1()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">SQLException{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Object[] objs =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font><font face="Consolas"><span style="font-size:12pt">.query(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;select * from account&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ArrayHandler());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Object obj:objs)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(obj);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List&lt;Object[]&gt;中</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Test</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">test2()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">SQLException{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           List&lt;Object[]&gt; list =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font><font face="Consolas"><span style="font-size:12pt">.query(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;select * from account&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ArrayListHandler());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Object[] objs:list){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;------------------&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Object obj:objs)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(obj);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//ColumnListHandler：将结果集中某一列的数据存放到List&lt;Object&gt;中</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Test</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">test3()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">SQLException{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           List&lt;Object&gt; list =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font><font face="Consolas"><span style="font-size:12pt">.query(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;select * from account&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ColumnListHandler(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;name&quot;</span></font><font face="Consolas"><span style="font-size:12pt">));</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Object obj:list)</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(obj);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//KeyedHandler(name)：将结果集中的每一行数据都封装到一个Map&lt;列名,列值&gt;里，再把这些map再存到一个map里，其key为指定的key</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Test</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">test4()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">SQLException{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Map&lt;Object,Map&lt;String,Object&gt;&gt; bmap=</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font><font face="Consolas"><span style="font-size:12pt">.query(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;select * from account&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">KeyedHandler(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;id&quot;</span></font><font face="Consolas"><span style="font-size:12pt">));</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Map.Entry&lt;Object, Map&lt;String,Object&gt;&gt; bme:bmap.entrySet()){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;------------------&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Map.Entry&lt;String, Object&gt; lme:bme.getValue().entrySet()){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(lme.getKey()+</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;=&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+lme.getValue());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值。</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Test</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">test5()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">SQLException{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Map&lt;String,Object&gt; map=</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font><font face="Consolas"><span style="font-size:12pt">.query(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;select * from account&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">MapHandler());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Map.Entry&lt;String, Object&gt; lme:map.entrySet()){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(lme.getKey()+</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;=&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+lme.getValue());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//MapListHandler：将结果集中的每一行数据都封装到一个Map里，然后再存放到List</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Test</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">test6()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">SQLException{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           List&lt;Map&lt;String,Object&gt;&gt; list=</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font><font face="Consolas"><span style="font-size:12pt">.query(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;select * from account&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">MapListHandler());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Map&lt;String,Object&gt; map:list){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;------------------&quot;</span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>for</b></span></font><font face="Consolas"><span style="font-size:12pt">(Map.Entry&lt;String, Object&gt; lme:map.entrySet()){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                     System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(lme.getKey()+</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;=&quot;</span></font><font face="Consolas"><span style="font-size:12pt">+lme.getValue());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//ScalarHandler:适合一列一行。单行单列，返回的是一个Object</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#646464" face="Consolas"><span style="font-size:12pt">@Test</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">test7()</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>throws</b></span></font> <font face="Consolas"><span style="font-size:12pt">SQLException{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Object obj =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt">qr</span></font><font face="Consolas"><span style="font-size:12pt">.query(</span></font> <font color="#2A00FF" face="Consolas"><span style="font-size:12pt">&quot;select count(*) from account&quot;</span></font><font face="Consolas"><span style="font-size:12pt">,</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ScalarHandler(1));</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(obj.getClass().getName());</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           System.</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>out</i></span></font><font face="Consolas"><span style="font-size:12pt">.println(obj);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><img src="jdcb-4 DBUtil_files/Image [1].png" type="image/png" style="cursor: default;cursor: default;cursor: default;"/></div></dd><dt>    <span style="font-size: 16px;"> </span></dt><dt style="font-size: 16px;">     //数据库类型和Java类型的对应关系：TEXT&lt;---&gt;Clob    BLOB&lt;---&gt;Blob<br/>
     //读取大数据时应尽量使用PreparedStatement流的形式</dt></dl></div><h1 style="margin-bottom:0pt; margin-top:0pt;"><span style="font-size: 22pt; font-family: 宋体;">二、实际开发中的事务控制：<font face="Times New Roman">DBUtil</font></span></h1><p style="margin-bottom:0pt; margin-top:0pt;"><span style="mso-spacerun:'yes'; font-size:10.5000pt; font-family:'宋体';">level1<font face="宋体">：不能这么写。</font><font face="Times New Roman">dao</font><font face="宋体">不能牵扯业务逻辑</font></span></p><p style="margin-bottom:0pt; margin-top:0pt;"><span style="mso-spacerun:'yes'; font-size:10.5000pt; font-family:'宋体';">level2: <font face="宋体">事务控制在了业务层。业务层用到了</font><font face="Times New Roman">java.sql.*</font><font face="宋体">相关类（不是很爽）</font></span></p><p style="margin-bottom:0pt; margin-top:0pt;"><span style="mso-spacerun:'yes'; font-size:10.5000pt; font-family:'宋体';">level3<font face="宋体">：</font><font face="Times New Roman">ThreadLocal</font><font face="宋体">控制事务，</font><font face="Times New Roman">TransactionManager</font></span></p><p style="margin-bottom:0pt; margin-top:0pt;"><span style="mso-spacerun:'yes'; font-size:10.5000pt; font-family:'宋体';">level4<font face="宋体">：利用动态代理，用</font><font face="Times New Roman">AOP</font><font face="宋体">思想控制事务。</font></span></p><p style="margin-bottom:0pt; margin-top:0pt;"><span style="mso-spacerun:'yes'; font-size:10.5000pt; font-family:'宋体';"> </span></p><h1 style="margin-bottom:0pt; margin-top:0pt;"><span style="font-size: 22pt; font-family: 宋体;">三、<font face="Times New Roman">ThreadLocal</font><font face="宋体">（重点）</font></span></h1><div style="font-size: 19px;">1.  ThreadLoacl 是一个类内部有一个map，容器。当前线程往里面存东西，只有当前线程能够取出来。此种的变量为局部变量。</div><div style="font-size: 19px;"><ul><li><ul><li>java.lang.ThreadLocal&lt;T&gt;中的方法：</li><li> 构造方法：
<table border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation"><tbody><tr><th><br/>
Constructor and Description</th></tr><tr><td><code><span><a>ThreadLocal</a></span>()</code><div>Creates a thread local variable.</div></td></tr></tbody></table></li></ul></li></ul></div><div><ul><li><ul><li><table border="0" cellpadding="3" cellspacing="0" style="font-size: 19px;" summary="Method Summary table, listing methods, and an explanation"><tbody><tr><td><code><a href="mk:java/lang/ThreadLocal.html" title="type parameter in ThreadLocal">T</a></code></td><td><code><a href="mk:java/lang/ThreadLocal.html#get--">get</a>()</code><div>Returns the value in the current thread's copy of this thread-local variable.</div></td></tr><tr><td><code>protected <a href="mk:java/lang/ThreadLocal.html" title="type parameter in ThreadLocal">T</a></code></td><td><code><a href="mk:java/lang/ThreadLocal.html#initialValue--">initialValue</a>()</code><div>Returns the current thread's &quot;initial value&quot; for this thread-local variable.</div></td></tr><tr><td><code>void</code></td><td><code><a href="mk:java/lang/ThreadLocal.html#remove--">remove</a>()</code><div>Removes the current thread's value for this thread-local variable.</div></td></tr><tr><td><code>void</code></td><td><code><a href="mk:java/lang/ThreadLocal.html#set-T-">set</a>(<a href="mk:java/lang/ThreadLocal.html" title="type parameter in ThreadLocal">T</a> value)</code><div>Sets the current thread's copy of this thread-local variable to the specified value.</div></td></tr><tr><td><code>static &lt;S&gt; <a href="mk:java/lang/ThreadLocal.html" title="class in java.lang">ThreadLocal</a>&lt;S&gt;</code></td><td><code><a href="mk:java/lang/ThreadLocal.html#withInitial-java.util.function.Supplier-">withInitial</a>(<a href="mk:java/util/function/Supplier.html" title="interface in java.util.function">Supplier</a>&lt;? extends S&gt; supplier)</code><div>Creates a thread local variable.</div></td></tr></tbody></table><div><p style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 宋体;"><br/><span style="font-size: 19px;">//</span><font face="宋体" style="font-size: 19px;">模拟</font></span><span style="font-family: 宋体; font-size: 19px;">ThreadLocal</span></p><p style="margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">public class ThreadLocal{</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">private Map&lt;Runnable,Object&gt; map = new HashMap&lt;Runnable,Object&gt;();</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">public void set(Object obj){</span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">map.put(Thread.currentThread(),obj);</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">}</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">pulbic void remove(){</span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">map.remove(Thread.currentThread());</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">}</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">public Object get(){</span></p><p style="margin-left: 21pt; text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">return map.get(Thread.currentThread());</span></p><p style="text-indent: 21pt; margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">}</span></p><p style="margin-bottom: 0pt; margin-top: 0pt; font-size: 19px;"><span style="font-family: 宋体;">}</span></p></div></li></ul></li></ul></div><div><img src="jdcb-4 DBUtil_files/Image [2].png" type="image/png" style="cursor: default;cursor: default;cursor: default;"/></div><div style="font-size: 24px;">2.  TreadLocal的应用</div><div align="left"><font color="#7F0055" face="Consolas" size="4"><b><br/></b></font></div><div> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>package</b></span></font> <font face="Consolas"><span style="font-size:12pt">com.itheima.util;</span></font></div><div align="left"><font color="#010101" face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>import</b></span></font> <font face="Consolas"><span style="font-size:12pt">java.sql.Connection;</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>import</b></span></font> <font face="Consolas"><span style="font-size:12pt">java.sql.SQLException;</span></font></div><div align="left"><font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//所有与事务有关的管理器</span></font></div><div align="left"><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>class</b></span></font> <font face="Consolas"><span style="font-size:12pt">TransactionManager {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>private</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font face="Consolas"><span style="font-size:12pt">ThreadLocal&lt;Connection&gt;</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>tl</i></span></font> <font face="Consolas"><span style="font-size:12pt">=</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>new</b></span></font> <font face="Consolas"><span style="font-size:12pt">ThreadLocal&lt;Connection&gt;();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font face="Consolas"><span style="font-size:12pt">Connection getConnection(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Connection conn =</span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>tl</i></span></font><font face="Consolas"><span style="font-size:12pt">.get();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>if</b></span></font><font face="Consolas"><span style="font-size:12pt">(conn==</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>null</b></span></font><font face="Consolas"><span style="font-size:12pt">){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                conn = DBCPUtil.</span> <span style="font-size:12pt"><i>getConnection</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>tl</i></span></font><font face="Consolas"><span style="font-size:12pt">.set(conn);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>return</b></span></font> <font face="Consolas"><span style="font-size:12pt">conn;</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">startTransaction(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Connection conn =</span> <span style="font-size:12pt"><i>getConnection</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                conn.setAutoCommit(</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>false</b></span></font><font face="Consolas"><span style="font-size:12pt">);</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(SQLException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                e.printStackTrace();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">rollback(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Connection conn =</span> <span style="font-size:12pt"><i>getConnection</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                conn.rollback();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(SQLException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                e.printStackTrace();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">commit(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Connection conn =</span> <span style="font-size:12pt"><i>getConnection</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                conn.commit();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(SQLException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                e.printStackTrace();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     </span></font><font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>public</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>static</b></span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>void</b></span></font> <font face="Consolas"><span style="font-size:12pt">release(){</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           Connection conn =</span> <span style="font-size:12pt"><i>getConnection</i></span><span style="font-size:12pt">();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           </span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>try</b></span></font> <font face="Consolas"><span style="font-size:12pt">{</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                conn.close();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                </span></font> <font color="#0000C0" face="Consolas"><span style="font-size:12pt"><i>tl</i></span></font><font face="Consolas"><span style="font-size:12pt">.remove();</span></font> <font color="#3F7F5F" face="Consolas"><span style="font-size:12pt">//从当前线程上解绑。    服务器用了线程池。</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font> <font color="#7F0055" face="Consolas"><span style="font-size:12pt"><b>catch</b></span></font> <font face="Consolas"><span style="font-size:12pt">(SQLException e) {</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">                e.printStackTrace();</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">           }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">     }</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt">}</span></font></div><div align="left"><font face="Consolas"><span style="font-size:12pt"><br/></span></font></div><div align="left"><font face="Consolas" size="4">      </font></div><p style="margin-bottom:0pt; margin-top:0pt;"><font face="宋体"><span style="font-size: 14px;"><br/></span></font></p><h1 style="margin-bottom:0pt; margin-top:0pt;"><span style="font-size: 22pt; font-family: 宋体;">四、AOP<font face="宋体">编程思想（重点）</font></span></h1><div><img src="jdcb-4 DBUtil_files/Image [3].png" type="image/png" height="616" style="cursor: default;cursor: default;" width="1086"/></div><div><span style="font-size: 22pt; font-family: 宋体;"><font face="宋体"><br/></font></span></div><div><span style="font-size: 22pt; font-family: 宋体;"><font face="宋体"><br/></font></span></div><div><span style="font-size: 22pt; font-family: 宋体;"><font face="宋体"><br/></font></span></div><h1 style="margin-bottom:0pt; margin-top:0pt;"><span style="font-size: 22pt; font-family: 宋体;">利用<font face="Times New Roman">DBUtil</font><font face="宋体">进行多表的查询和存储数据</font></span></h1><p style="margin-bottom:0pt; margin-top:0pt;"><span style="mso-spacerun:'yes'; font-size:10.5000pt; font-family:'宋体';"> </span></p></div>
</div></body></html> 