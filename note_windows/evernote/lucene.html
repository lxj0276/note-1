<html>
<head>
  <title>lucene</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="7491"/>
<h1>lucene</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/9/21 8:32</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/9/22 2:04</i></td></tr>
<tr><td><b>标签：</b></td><td><i>Lucene</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.chedong.com/tech/lucene.html"><i>http://www.chedong.com/tech/lucene.html</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><h2 style="font-weight: normal; margin-top: 10px; margin-bottom: 10px; color: rgb(51, 51, 51); text-align: left; font-size: 32px;"><font size="3" style="-evernote-highlight:true;background-color:rgb(255, 250, 165);font-size: 24px;">一</font></h2><h2 style="font-weight: normal; margin-top: 10px; margin-bottom: 10px; color: rgb(51, 51, 51); text-align: left; background-color: rgb(255, 255, 255);"><font size="3">Lucene：基于Java的全文检索引擎简介：<a href="http://www.chedong.com/tech/lucene.html#compare">http://www.chedong.com/tech/lucene.html#compare</a></font></h2><hr/><strong style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">全文检索的实现机制：</strong><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">lucene输入输出结构很像数据库的表---&gt;记录---&gt;字段，可以先把</span><strong style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">Lucene当成一个支持全文索引的数据库系统</strong><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">。</span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);"><br/></span></div><div><strong style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">对于检索系统来说核心是一个排序问题</strong><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">。</span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);"><br/></span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">Lucene最核心的特征：通过特殊的索引结构实现了全文索引机制，并提供扩展接口，用于方便制定不同应用的定制。</span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);"><br/></span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">索引一般分2种情况，一种是小批量的索引扩展，一种是大批量的索引重建。</span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);"><br/></span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">建立一个高效检索系统的关键是建立一个类似于科技索引一样的反向索引机制，将数据源（比如多篇文章）排序顺序存储的同时，有另外一个排好序的关键词列表，用于存储关键词==&gt;文章映射关系，利用这样的映射关系索引：[关键词==&gt;出现关键词的文章编号，出现次数（甚至包括位置：起始偏移量，结束偏移量），出现频率]，检索过程就是把</span><strong style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">模糊查询变成多个可以利用索引的精确查询的逻辑组合的过程</strong><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">。从而大大提高了多关键词查询的效率，所以，全文检索问题归结到最后是一个排序问题。</span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);"><br/></span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">比较一下Lucene和数据库：</span></div><div><table border="1" style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);" width="100%"><tbody><tr><td align="center" style="width: 385px;">Lucene</td><td align="center" style="width: 420px;">数据库</td></tr><tr><td style="width: 385px;"><pre style="margin-top: 10px; margin-bottom: 10px;">
索引数据源：doc(field1,field2...) doc(field1,field2...)<br/>                  \  indexer /<br/>                 _____________<br/>                | Lucene Index|<br/>                --------------<br/>                 / searcher \<br/> 结果输出：Hits(doc(field1,field2) doc(field1...))
</pre></td><td style="width: 420px;"><pre style="margin-top: 10px; margin-bottom: 10px;">
 索引数据源：record(field1,field2...) record(field1..)<br/>              \  SQL: insert/<br/>               _____________<br/>              | DB  Index   |<br/>               -------------<br/>              / SQL: select \<br/>结果输出：results(record(field1,field2..) record(field1...))
</pre></td></tr><tr><td style="width: 385px;">Document：一个需要进行索引的“单元”<br/>
一个Document由多个字段组成</td><td style="width: 420px;">Record：记录，包含多个字段</td></tr><tr><td style="width: 385px;">Field：字段</td><td style="width: 420px;">Field：字段</td></tr><tr><td style="width: 385px;">Hits：查询结果集，由匹配的Document组成</td><td style="width: 420px;">RecordSet：查询结果集，由多个Record组成</td></tr></tbody></table></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);"><br/></span></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">可以通过一下表格对比一下数据库的模糊查询：</span></div><div><table border="1" style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; height: 283px; background-color: rgb(255, 255, 255);" width="100%"><tbody><tr><td align="center" style="width: 63px; height: 16px;">　</td><td align="center" style="width: 354px; height: 16px;">Lucene全文索引引擎</td><td align="center" style="width: 301px; height: 16px;">数据库</td></tr><tr><td style="width: 63px; height: 48px;">索引</td><td style="width: 354px; height: 48px;">将数据源中的数据都通过全文索引一一建立反向索引</td><td style="width: 301px; height: 48px;">对于LIKE查询来说，数据传统的索引是根本用不上的。数据需要逐个便利记录进行GREP式的模糊匹配，比有索引的搜索速度要有多个数量级的下降。</td></tr><tr><td style="width: 63px; height: 49px;">匹配效果</td><td style="width: 354px; height: 49px;">通过词元(term)进行匹配，通过语言分析接口的实现，可以实现对中文等非英语的支持。</td><td style="width: 301px; height: 49px;">使用：like &quot;%net%&quot; 会把netherlands也匹配出来，<br/>
多个关键词的模糊匹配：使用like &quot;%com%net%&quot;：就不能匹配词序颠倒的xxx.net..xxx.com</td></tr><tr><td style="width: 63px; height: 32px;">匹配度</td><td style="width: 354px; height: 32px;">有匹配度算法，将匹配程度（相似度）比较高的结果排在前面。</td><td style="width: 301px; height: 32px;">没有匹配程度的控制：比如有记录中net出现5词和出现1次的，结果是一样的。</td></tr><tr><td style="width: 63px; height: 32px;">结果输出</td><td style="width: 354px; height: 32px;">通过特别的算法，将最匹配度最高的头100条结果输出，结果集是缓冲式的小批量读取的。</td><td style="width: 301px; height: 32px;">返回所有的结果集，在匹配条目非常多的时候（比如上万条）需要大量的内存存放这些临时结果集。</td></tr><tr><td style="width: 63px; height: 32px;">可定制性</td><td style="width: 354px; height: 32px;">通过不同的语言分析接口实现，可以方便的定制出符合应用需要的索引规则（包括对中文的支持）</td><td style="width: 301px; height: 32px;">没有接口或接口复杂，无法定制</td></tr><tr><td style="width: 63px; height: 32px;">结论</td><td style="width: 354px; height: 32px;">高负载的模糊查询应用，需要负责的模糊查询的规则，索引的资料量比较大</td><td style="width: 301px; height: 32px;">使用率低，模糊匹配规则简单或者需要模糊查询的资料量少</td></tr></tbody></table><br/></div><div>Lucene的创新之处：</div><div>大部分的搜索（数据库）引擎都是用B树结构来维护索引，索引的更新会导致大量的IO操作，Lucene在实现中，对此稍微有所改进：不是维护一个索引文件，而是在扩展索引的时候不断创建新的索引文件，然后定期的把这些新的小索引文件合并到原先的大索引中（针对不同的更新策略，批次的大小可以调整），这样在不影响检索的效率的前提下，提高了索引的效率。</div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">Lucene和其他一些全文检索系统/应用的比较：</span></div><div><table border="1" style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);" width="100%"><tbody><tr><td align="center" style="width: 128px;">　</td><td align="center" style="width: 324px;">Lucene</td><td align="center" style="width: 266px;">其他开源全文检索系统</td></tr><tr><td style="width: 128px;">增量索引和批量索引</td><td style="width: 324px;">可以进行增量的索引(Append)，可以对于大量数据进行批量索引，并且接口设计用于优化批量索引和小批量的增量索引。</td><td style="width: 266px;">很多系统只支持批量的索引，有时数据源有一点增加也需要重建索引。</td></tr><tr><td style="width: 128px;">数据源</td><td style="width: 324px;">Lucene没有定义具体的数据源，而是一个文档的结构，因此可以非常灵活的适应各种应用（只要前端有合适的转换器把数据源转换成相应结构），</td><td style="width: 266px;">很多系统只针对网页，缺乏其他格式文档的灵活性。</td></tr><tr><td style="width: 128px;">索引内容抓取</td><td style="width: 324px;">Lucene的文档是由多个字段组成的，甚至可以控制那些字段需要进行索引，那些字段不需要索引，近一步索引的字段也分为需要分词和不需要分词的类型：<br/>
   需要进行分词的索引，比如：标题，文章内容字段<br/>
   不需要进行分词的索引，比如：作者/日期字段</td><td style="width: 266px;">缺乏通用性，往往将文档整个索引了</td></tr><tr><td style="width: 128px;">语言分析</td><td style="width: 324px;">通过语言分析器的不同扩展实现：<br/>
可以过滤掉不需要的词：an the of 等，<br/>
西文语法分析：将jumps jumped jumper都归结成jump进行索引/检索<br/>
非英文支持：对亚洲语言，阿拉伯语言的索引支持</td><td style="width: 266px;">缺乏通用接口实现</td></tr><tr><td style="width: 128px;">查询分析</td><td style="width: 324px;">通过查询分析接口的实现，可以定制自己的查询语法规则：<br/>
比如： 多个关键词之间的 + - and or关系等</td><td style="width: 266px;">　</td></tr><tr><td style="width: 128px;">并发访问</td><td style="width: 324px;">能够支持多用户的使用</td><td style="width: 266px;">　</td></tr></tbody></table></div><div><br/></div><div><br/></div><div><p style="margin-top: 10px; margin-bottom: 10px; color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);">lucene的组成结构：对于外部应用来说索引模块(index)和检索模块(search)是主要的外部应用入口</p><table border="1" style="color: rgb(51, 51, 51); font-size: 14px; line-height: 21px; text-align: left; background-color: rgb(255, 255, 255);" width="100%"><tbody><tr><td style="width: 208px;">org.apache.Lucene.search/</td><td style="width: 516px;">搜索入口</td></tr><tr><td style="width: 208px;">org.apache.Lucene.index/</td><td style="width: 516px;">索引入口</td></tr><tr><td style="width: 208px;">org.apache.Lucene.analysis/</td><td style="width: 516px;">语言分析器</td></tr><tr><td style="width: 208px;">org.apache.Lucene.queryParser/</td><td style="width: 516px;">查询分析器</td></tr><tr><td style="width: 208px;">org.apache.Lucene.document/</td><td style="width: 516px;">存储结构</td></tr><tr><td style="width: 208px;">org.apache.Lucene.store/ </td><td style="width: 516px;">底层IO/存储结构</td></tr><tr><td style="width: 208px;">org.apache.Lucene.util/</td><td style="width: 516px;">一些公用的数据结构</td></tr></tbody></table></div><div><br/></div><div><hr/><hr/><hr style="font-size: 24px;"/><span style="-evernote-highlight:true;background-color:rgb(255, 250, 165);font-family: Simsun; font-size: 24px;">二</span></div><div><h2 style="font-family: Simsun; font-size: 27px;"><font size="3" style="font-size: 19px;">Advanced Text Indexing with Lucene：<a href="http://www.onjava.com/lpt/a/3273">http://www.onjava.com/lpt/a/3273</a></font></h2></div><div><span style="font-family: Simsun; background-color: rgb(255, 255, 255);">The core elements of such an index are segments, documents, fields, and terms. Every index consists of one or more segments. Each segment contains one or more documents. Each document has one or more fields, and each field contains one or more terms. Each term is a pair of </span><code style="background-color: rgb(255, 255, 255);">String</code><span style="font-family: Simsun; background-color: rgb(255, 255, 255);">s representing a field name and a value. A segment consists of a series of files.</span></div><div><span style="font-family: Simsun; background-color: rgb(255, 255, 255);"><br/></span></div><div><hr/><hr/><hr/></div><div style="font-size: 24px;"><font face="Simsun" style="-evernote-highlight:true;background-color:rgb(255, 250, 165);">三</font></div><div><font face="Simsun"><span>中文分词（World Segmentation）</span>：<a href="http://blog.minidx.com/2008/01/04/352.html">http://blog.minidx.com/2008/01/04/352.html</a><br/></font></div><div><font face="Simsun"><br/></font></div><div><font face="Simsun"><br/></font></div><div><font face="Simsun"><br/></font></div></div>
</div></body></html> 