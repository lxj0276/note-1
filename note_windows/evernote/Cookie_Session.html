<html>
<head>
  <title>Cookie_Session</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="1978"/>
<h1>Cookie_Session</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/7/22 15:34</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/8/22 8:29</i></td></tr>
<tr><td><b>标签：</b></td><td><i>Cookie, Session</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="about:blank"><i>about:blank</i></a></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><span style="font-family: 微软雅黑;">会话管理</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        什么是会话？</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                会话可简单理解为：用户开一个浏览器，点击多个超链接，访问服务器多个web资源，然后关闭浏览器，整个过程称之为一个会话。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        思考:用户购买的商品保存在request或servletContext中行不行？</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                不行,因为它们各自的作用范围不同,request只对当次请求有效,也就相当于每次只能买一件商品;servletContext作用范围太大,作用</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                于整个当前的web应用,也就相当于自己买的商品其它登录这个网站的人也可删除修改</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">1,cookie</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (1)cookie是什么?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                用于存储会话过程中产生的数据,保存在客户端;当服务器需要使用时,又从客户端发送到服务器</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (2)javax.servlet.http.Cookie类:用于创建一个Cookie</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        response.addCookie()它用于在其响应头中增加一个相应的Set-Cookie头字段。 </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        request.getCookies()它用于获取客户端提交的Cookie。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (3)cookie属性</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        1)name： (必须)</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        2)value：(必须)不能是中文</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        3)maxage：(必须)最长存活时间.默认是会话。单位是秒</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        4)path：（可选）路径</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                一个cookie的默认路径是：写cookie的那个servlet的访问路径。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                写cookie的servlet的路径是：String path = /当前项目名/servlet/</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        如果访问的路径.startWith(path),浏览器就会把刚才写的cookie带给服务器。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        这里的path是cookie里存的path,由domain+path+name共同决定</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        5)domain ：（可选）域名</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        6)comment：（可选）注释</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        7)version：（可选）版本号</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (4)服务器如何向客户端写Cookie： </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        HttpServletResponse.addCookie(javax.servlet.http.Cookie)（实际上就是写了一个Set-Cookie的响应消息头）</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        浏览器对于一个网站最多存20个cookie  （Cookie的个数是有限的）</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        cookie总数不能超过300个。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        每个Cookie大小不能超过4KB。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (5)服务器如何取出客户端带来的cookie：HttpServletRequest.getCookies() （实际上就是获取 名字为cookie的请求消息头）</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (6)浏览器是不是要把一个cookie发给服务器,是由谁决定的?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        浏览器决定的,</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                  浏览器是如何决定的呢?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        主要是根据domain+path+name共同决定的,如果访问的路径.startWith(path),浏览器就会把刚才写的cookie带给服务器。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        这里的path是cookie里存的path,由domain+path+name共同决定,如果Path匹配,再根据name来取值使用</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                                localhost/day09_cookie/servlet/  + lastAccessTime</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (7)Cookie细节</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                1)一个cookie文件只能标识一种信息,也就是它只能有name和value;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                2)一个网站可以发送多个cookie,一个浏览器也可以存多个网站发的多个cookie;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                3)每个浏览器最多存300个cookie,每个网站最多存20个cookie,每个cookie最多4KB大;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                4)创建了一个cookie发送到浏览器，默认它是存储在浏览器的内存中，用户退出浏览器之后即被删除。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        若希望浏览器将该cookie存储在磁盘上，则需要使用maxAge，并给出一个以秒为单位的时间。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        将最大时效设为0则是删除该cookie。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                注意，删除cookie时，path必须一致，否则不会删除</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        (8)Cookie类的常用方法</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                1)getCookies():得到Cookie,返回一个Cookie[];</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                2)new Cookie(String name,String value):构造一个Cookie/放入值到Cookie;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                3)addCookie(new Cookie):写回Cookie给浏览器</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                4)setMaxAge与getMaxAge方法 (秒):设置存在时间,0就是删除,</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                5)setValue与getValue方法 </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                6)setPath与getPath方法</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                7)setDomain与getDomain方法</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                8)getName方法 </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">2,session</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        其实就是HttpSession,session是由服务器创建的</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (1)怎么得到session?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        三种写法:</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                1)request.getSession();</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                2)request.getSession(true);</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        这两种写法是一样的,先判断有没有;有直接返回,没有就创建一个新的;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                3)request.getSession(flase):</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        这种方法只获取,没有就返回null;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (2)session的实现原理?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        与Cookie一样,只不过不发数据,数据保存在服器上,它发的是一个叫JSsessionID的号,</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        如果浏览器发的JSsessionID与服务器的JSsessionId相同,说明是同一个Session,服务器就把数据存在Session中;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (3)session只与浏览器有关,每个浏览器窗口都有一个独立的session,</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (4)Session和Cookie的主要区别在于：</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                Cookie是把用户的数据写给用户的浏览器。</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                Session技术把用户的数据写到用户独占的session中</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (5)怎么用?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                使用Session就是把它当成一个域对象,方法有:</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        setAttribute(&quot;&quot;,Object);</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        getAttribute();</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        removeAttribute();</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        希望Cookie使用范围比较大,则使用获取request.getcontextPath();这个代码获取到的就是当前应用名</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (6)存活时间?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        默认存活时间是30分钟(这里30分钟是指闲置时间,就是不操作),30分钟后强制销毁,</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        setMaxvalue():最大存活时间</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        强制销毁使用:</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                session.invalidate();</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (7)示例:</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        利用session完成登录</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        防止表单重复提交</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        记住:以后写实体实现都要实现序列化接口(Serializable);</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                (8)        当Cookie被禁用时,可能会导致程序不能用,怎么解决?</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        方法一:在程序运行前提示;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                        方法二:重写所有的URL;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                        String url=response.encodeURL(url);</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                                重写后会在参数里加入Jsession,如果Cookie被禁用时会自动加,如果没禁用则不会加;</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">        如果通过链接打开的窗口,跟当前会话是同一个会话,</span><br style="background-color: inherit; font-family: 微软雅黑;"/><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">四个域对象,内部实现其实就是内部维护一个Map集合,</span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                </span><br style="background-color: inherit; font-family: 微软雅黑;"/><span style="font-family: 微软雅黑;">                </span></div>
</div></body></html> 