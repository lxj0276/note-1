<html>
<head>
  <title>04对象创建机制-单例和多例</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="5232"/>
<h1>04对象创建机制-单例和多例</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/8/10 21:32</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/8/18 14:31</i></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="justify" style="font-size: 32px;"><font color="#3665EE" face="Times New Roman" style="background-color: rgb(255, 250, 165);"><b>单例多例</b></font></div><div align="justify"><font color="#010101" face="Times New Roman">spring</font><font color="#010101" face="宋体">容器中的对象是单例还是多例取决于</font><font color="#010101" face="Times New Roman">scope属性</font><font color="#010101" face="宋体">。</font></div><div align="justify"><font color="#010101" face="宋体">查看方式：获取两次，查看对象的内存地址。或者看构造函数的执行的次数。</font></div><div align="justify"><font color="#010101" face="宋体">该容器的</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">默认的是单例。如果一个类放入到容器中，并且该类是单例的，那么，该类中的属性（成员变量）将会成为共享的，有线程安全问题。一般情况下，不把一个数据声明为该类的属性（成员变量）。</font></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div align="justify"><font color="#010101" face="宋体">通过配置文件，</font> <font color="#010101" face="Times New Roman">scope</font><font color="#010101" face="宋体">属性赋值为：</font><font color="#010101" face="Times New Roman">singleton/prototype</font><font color="#010101" face="宋体">，单例</font> <font color="#010101" face="Times New Roman">/</font><font color="#010101" face="宋体">多例。（是对一个</font><font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">而言）</font></div><div align="justify"><img src="04对象创建机制-单例和多例_files/Image.png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div align="justify"><hr/></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div align="justify" style="font-size: 32px;"><font color="#3665EE" face="宋体"><b style="background-color: rgb(255, 250, 165);">创建对象的时机</b></font></div><div align="justify"><font color="#010101" face="宋体">默认：启动容器，</font> <font color="#010101" face="Times New Roman">-----</font><font color="#010101" face="宋体">》自动查询</font><font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">，创建对象</font> <font color="#010101" face="Times New Roman">-----</font><font color="#010101" face="宋体">》对象调用方法。</font></div><div align="justify"><font color="#010101" face="宋体">也就是说，默认的启动容器的时候，就会创建</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">，在客户端要使用的时候，才会给客户。</font></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div align="justify"><font color="#010101" face="宋体">修改创建时机：懒加载，延迟。在使用</font> <font color="#010101" face="Times New Roman">getbean</font><font color="#010101" face="宋体">（）的时候才会创建</font><font color="#010101" face="Times New Roman">bean</font></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div align="justify"><font color="#010101" face="宋体">启动</font> <font color="#010101" face="Times New Roman">---</font><font color="#010101" face="宋体">》调用对象</font><font color="#010101" face="Times New Roman">------</font><font color="#010101" face="宋体">》创建对象。</font></div><div align="justify"><img src="04对象创建机制-单例和多例_files/Image [1].png" type="image/png" alt="graphic" border="0" height="49" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="549"/></div><div align="justify"><font color="#010101" face="宋体">该情况下，启动容器的时候，不会产生</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">，只有客户端需要的时候也就是用到的时候，才会给予该</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">。</font></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div align="justify"><font color="#010101" face="Times New Roman"><br/></font></div><div align="justify"><font color="#010101" face="宋体">方式一和方式二各有千秋，如果一个</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">存放了大量的数据，就不能使用方式一。因此全部存放到内存不好。</font></div><div align="justify"><font color="#010101" face="宋体">方式二，</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">的产生会滞后，不能够及早的发现错误。</font></div><div align="justify"><div align="justify"><font color="#010101" face="宋体">如果把lazy-init设置为true，则当spring容器启动的时候，检测不到任何错误，这样会存在很大的安全性隐患，所以一般情况下应该设置lazy-init为default/false。但是如果一个bean中有一个属性，该属性含有大量的数据，这个时候不希望该bean过早的停留在内存中。</font></div><div align="justify"><font color="#010101" face="宋体">这个时候需要用到lazy-init为true。</font></div><div><font color="#010101" face="宋体"><br/></font></div></div><div align="justify"><font color="#010101" face="宋体"><br/></font></div><div align="justify"><font color="#010101" face="宋体">注：</font></div><div align="justify"><font color="#010101" face="宋体">如果一个</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">，不是单例，也就是说是多例的。那么不管怎么样配置，都是在</font> <font color="#010101" face="Times New Roman">getbean</font><font color="#010101" face="宋体">的时候，才会创建对象，因此容器启动的时候，只创建一次。（这是对于一个</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">而言的，这个是前提。）那么只对应该</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">只有有一个实例，因此，为了获得多例，那么每一次</font> <font color="#010101" face="Times New Roman">getbean</font><font color="#010101" face="宋体">（）的时候，都会产生该</font> <font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">对应的实例，也就是完成了多例的创建。</font></div><div align="justify"><font color="#010101" face="宋体">图解：</font></div><div align="justify"><img src="04对象创建机制-单例和多例_files/Image [2].png" type="image/png" height="484" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="896"/></div><div align="justify"><div style="font-size: 32px;"><b style="background-color: rgb(255, 250, 165); text-align: -webkit-auto;">注意，装配，也就是依赖注入，是在init方法之前进行的。</b></div></div><hr/><div align="justify" style="font-size: 32px;"><b style="background-color: rgb(255, 250, 165);"><font color="#3665EE"><font face="Times New Roman">init</font><font face="宋体">方法</font><font face="Times New Roman">&amp;destroy</font> <font face="宋体">方法</font></font></b></div><div align="justify"><img src="04对象创建机制-单例和多例_files/Image [3].png" type="image/png" alt="graphic" border="0" height="125" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="550"/></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">执行顺序：</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">启动容器，</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">默认容器启动的时候容器创建对象，</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">调用</font><font color="#010101" face="Times New Roman">init</font> <font color="#010101" face="宋体">方法，</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">执行客户端调用的方法。</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;"><font color="#010101" face="宋体">容器关闭，调用</font><font color="#010101" face="Times New Roman">dstory</font><font color="#010101" face="宋体">方法。（前提条件，单例下，才可以调用</font> <font color="#010101" face="Times New Roman">destory</font><font color="#010101" face="宋体">，多例情况下，不负责</font><font color="#010101" face="Times New Roman">bean</font><font color="#010101" face="宋体">的销毁。）</font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;"><img src="04对象创建机制-单例和多例_files/Image [4].png" type="image/png" alt="graphic" border="0" height="192" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="225"/><font color="#010101" face="Times New Roman"><br/><br/></font></div><div align="justify"><font color="#010101" face="宋体">在</font><font color="#010101" face="Times New Roman">spring</font><font color="#010101" face="宋体">容器中，对于多例，只负责创建，不负责销毁，</font> <font color="#010101" face="Times New Roman">struts2</font><font color="#010101" face="宋体">的</font><font color="#010101" face="Times New Roman">action</font> <font color="#010101" face="宋体">由</font><font color="#010101" face="Times New Roman">spring</font><font color="#010101" face="宋体">创建，但是销毁由</font> <font color="#010101" face="Times New Roman">struts2</font><font color="#010101" face="宋体">负责销毁。对于单例，负责创建，以及销毁。</font></div><div align="justify"><br/></div><div align="justify"><br/></div></div>
</div></body></html> 