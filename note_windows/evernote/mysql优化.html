<html>
<head>
  <title>mysql优化</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272236; Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="6767"/>
<h1>mysql优化</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2014/9/10 12:24</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2014/10/24 2:47</i></td></tr>
<tr><td><b>标签：</b></td><td><i>mysql优化</i></td></tr>
</table>
</div>
<br/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; font-weight: bold;">1.为查询缓存优化你的查询</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-size: 24px; font-family: 宋体; font-weight: bold;">     </span><span style="font-family: Arial;">MySQL</span><span style="font-family: 宋体;">的查询缓存对某些函数不起作用。所以，像</span> <span style="font-family: Arial;">NOW()</span> <span style="font-family: 宋体;">和</span> <span style="font-family: Arial;">RAND()</span> <span style="font-family: 宋体;">或是其它的诸如此类的</span><span style="font-family: Arial;">SQL</span><span style="font-family: 宋体;">函数都不会开启查询缓存，因为这些函数的返回是会不定的易变的。</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="line-height: 90%; text-indent: -0.56in; font-weight: bold; font-family: Arial;">2.EXPLAIN</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">你的</span> <span style="line-height: 90%; text-indent: -0.56in; font-weight: bold; font-family: Arial;">SELECT</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">查</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="text-indent: -0.56in; line-height: 90%; font-weight: bold; font-family: Arial;">3.当只要一行数据时使用</span> <span style="text-indent: -0.56in; line-height: 90%; font-weight: bold; font-family: Arial;">LIMIT 1</span><span style="text-indent: -0.56in; line-height: 90%; font-weight: bold; font-family: Arial;"> </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; line-height: 90%; text-indent: -0.56in; font-weight: bold;">4.为搜索字段建索引</span><span style="line-height: 90%; text-indent: -0.56in; font-weight: bold; font-family: Arial;"> </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><img src="mysql优化_files/Image.png" type="image/png" height="260" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="780"/></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; line-height: 90%; text-indent: -0.56in; font-weight: bold;">5.在</span><span style="line-height: 90%; text-indent: -0.56in; font-weight: bold; font-family: Arial;">Join</span><span style="font-family: 宋体; line-height: 90%; text-indent: -0.56in; font-weight: bold;">表的时候使用相当类型的列，并将其索引 </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-family: 宋体; line-height: 90%; text-indent: -0.56in; font-weight: bold;"><font size="5"> </font>    </span><span style="line-height: 90%; font-family: Arial;">SELECT</span> <span style="line-height: 90%; font-family: Arial;">company_name</span> <span style="line-height: 90%; font-family: Arial;">FROM users </span><font face="Arial" style="line-height: 90%;">  LEFT JOIN companies ON (</font><span style="line-height: 90%; font-family: Arial;">users.state</span> <span style="line-height: 90%; font-family: Arial;">=</span> <span style="line-height: 90%; font-family: Arial;">companies.state</span><span style="line-height: 90%; font-family: Arial;">) </span><font face="Arial" style="line-height: 90%;"> WHERE</font> <span style="line-height: 90%; font-family: Arial;">users.id</span> <span style="line-height: 90%; font-family: Arial;">= “</span><span style="line-height: 90%; font-family: Arial;">user_id</span><span style="line-height: 90%; font-family: Arial;">”</span></div><p style="language:zh-CN;line-height:90%;margin-top:4.8pt;margin-bottom:0pt; text-align:left;direction:ltr;unicode-bidi:embed;vertical-align:baseline"></p><p style="language:zh-CN;line-height:90%;margin-top:4.8pt;margin-bottom:0pt; text-align:left;direction:ltr;unicode-bidi:embed;vertical-align:baseline"></p><p style="language:zh-CN;line-height:90%;margin-top:4.8pt;margin-bottom:0pt; text-align:left;direction:ltr;unicode-bidi:embed;vertical-align:baseline"><span style="font-family: 宋体; color: red;">       两个</span> <span style="font-family: Arial; color: red;">state</span> <span style="font-family: 宋体; color: red;">字段应该是被建过索引的，而且应该是相当的类型，相同的字符集。</span></p><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; line-height: 90%; text-indent: -0.56in; font-weight: bold;">6.千万不要</span> <span style="line-height: 90%; text-indent: -0.56in; font-weight: bold; font-family: Arial;">ORDER BY RAND()</span><span style="line-height: 90%; text-indent: -0.56in; font-weight: bold; font-family: Arial;"> </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; line-height: 90%; text-indent: -0.56in; font-weight: bold;">7.避免</span> <span style="line-height: 90%; text-indent: -0.56in; font-weight: bold; font-family: Arial;">SELECT * </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">8.使用</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: Arial; font-weight: bold;">ENUM</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">而不是</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: Arial; font-weight: bold;">VARCHAR</span><span style="line-height: 90%; text-indent: -0.56in; font-family: Arial;"> </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="line-height: 90%; text-indent: -0.56in; font-family: Arial;"><font size="5">   </font>  </span><span style="font-family: Arial;">ENUM</span> <span style="font-family: 宋体;">类型是非常快和紧凑的。在实际上，其保存的是</span> <span style="font-family: Arial;">TINYINT</span><span style="font-family: 宋体;">，但其外表上显示为字符串。这样一来，用这个字段来做一些选项列表变得相当的完美。 </span></div><br/><font face="宋体">    如果你有一个字段，比如“性别”，“国家”，“民族”，“状态”或“部门”，你知道这些字段的取值是有限而且固定的，那么，你应该使用</font> <span style="font-family: Arial;">ENUM</span> <span style="font-family: 宋体;">而不是</span> <span style="font-family: Arial;">VARCHAR</span><span style="font-family: 宋体;">。</span><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">9.尽可能的使用</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: Arial; font-weight: bold;">NOT NULL</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="line-height: 90%; text-indent: -0.56in; font-family: Arial;"><font size="5" style="font-weight: bold;">     </font>赋值为0或者&quot;&quot;</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">10.固定长度的表会更快</span><span style="line-height: 90%; text-indent: -0.56in; font-family: Arial;"> </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-size: 24px; line-height: 90%; text-indent: -0.56in; font-family: Arial;">     </span><span style="font-family: 宋体;">如果表中的所有字段都是“固定长度”的，整个表会被认为是 “</span><span style="font-family: Arial;">static”</span> <span style="font-family: 宋体;">或 “</span><span style="font-family: Arial;">fixed-length”</span><span style="font-family: 宋体;">。 例如，表中没有如下类型的字段：</span> <span style="font-family: Arial;">VARCHAR</span><span style="font-family: 宋体;">，</span><span style="font-family: Arial;">TEXT</span><span style="font-family: 宋体;">，</span><span style="font-family: Arial;">BLOB</span><span style="font-family: 宋体;">。只要你包括了其中一个这些字段，那么这个表就不是“固定长度静态表”了，这样，</span><span style="font-family: Arial;">MySQL</span> <span style="font-family: 宋体;">引擎会用另一种方法来处理。 </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">11.垂直分割</span><span style="line-height: 90%; text-indent: -0.56in; font-family: Arial;"> </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="line-height: 90%; text-indent: -0.56in; font-family: Arial;"><font size="5">   </font>  </span><span style="font-family: Arial;">“垂直分割”是一种把数据库中的表按列变成几张表的方法，这样可以降低表的复杂度和字段的数目，从而达到优化的目的。</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">12.拆分大的</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: Arial; font-weight: bold;">DELETE</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">或</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: Arial; font-weight: bold;">INSERT</span> <span style="line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">语句</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-size: 24px; line-height: 90%; text-indent: -0.56in; font-family: 宋体; font-weight: bold;">     </span><span style="font-family: 宋体;">如果你需要在一个在线的网站上去执行一个大的</span> <span style="font-family: Arial;">DELETE</span> <span style="font-family: 宋体;">或</span> <span style="font-family: Arial;">INSERT</span> <span style="font-family: 宋体;">查询，你需要非常小心，要避免你的操作让你的整个网站停止相应。因为这两个操作是会锁表的，表一锁</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-family: 宋体;">     住了，别的操作都进不来了。</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; font-weight: bold; line-height: 90%; text-indent: -0.56in;">13.越小的列会越快 </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-size: 24px; font-family: 宋体; font-weight: bold; line-height: 90%; text-indent: -0.56in;">   </span><span style="font-family: 宋体;">对于大多数的数据库引擎来说，硬盘操作可能是最重大的瓶颈。所以，把你的数据变得紧凑会对这种情况非常有帮助，因为这减少了对硬盘的访问。 </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-family: 宋体;">     如果一个表只会有几列罢了（比如说字典表，配置表），那么，我们就没有理由使用</span> <span style="font-family: Arial;">INT</span> <span style="font-family: 宋体;">来做主键，使用</span> <span style="font-family: Arial;">MEDIUMINT, SMALLINT</span> <span style="font-family: 宋体;">或是更小的</span> <span style="font-family: Arial;">TINYINT</span> <span style="font-family: 宋体;">会更经济一些。如果你不需要记录时间，使用</span> <span style="font-family: Arial;">DATE</span> <span style="font-family: 宋体;">要比</span> <span style="font-family: Arial;">DATETIME</span> <span style="font-family: 宋体;">好得多。</span><span style="font-size: 20pt; font-family: 宋体;"> </span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; font-weight: bold; line-height: 90%; text-indent: -0.56in;">14.选择正确的存储引擎</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-size: 24px; font-family: 宋体; font-weight: bold; line-height: 90%; text-indent: -0.56in;">     </span><span style="font-family: 宋体;">在</span> <span style="font-family: Arial;">MySQL</span> <span style="font-family: 宋体;">中有两个存储引擎</span> <span style="font-family: Arial;">MyISAM</span> <span style="font-family: 宋体;">和</span> <span style="font-family: Arial;">InnoDB。</span></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-family: Arial;">          </span><span style="line-height: 90%; font-family: Arial;">MyISAM</span><span style="line-height: 90%; font-family: 宋体;">是</span><span style="line-height: 90%; font-family: Arial;">MySQL</span><span style="line-height: 90%; font-family: 宋体;">的默认存储引擎（</span><span style="line-height: 90%; font-family: Arial;">5.5</span><span style="line-height: 90%; font-family: 宋体;">以前），基于传统的</span><span style="line-height: 90%; font-family: Arial;">ISAM</span><span style="line-height: 90%; font-family: 宋体;">类型，支持</span><span style="line-height: 90%; font-family: Arial;">B-Tree</span><span style="line-height: 90%; font-family: 宋体;">，全文索引，但不是事务安全的，而且不支持外键。不具有原子性。支持表锁。</span></div><div><br/></div><div><span style="font-family: Arial;">          InnoDB</span><span style="font-family: 宋体;">是事务型引擎，支持</span><span style="font-family: Arial;">ACID</span><span style="font-family: 宋体;">事务（实现</span><span style="font-family: Arial;">4</span><span style="font-family: 宋体;">种事务隔离级别）、回滚、崩溃恢复能力、行锁。以及提供与</span><span style="font-family: Arial;">Oracle</span><span style="font-family: 宋体;">类型一致的不加锁读取方式。</span><span style="font-family: Arial;">InnoDB</span><span style="font-family: 宋体;">存储它的表和索引在一个表空           </span></div><div><span style="font-family: 宋体;">间中，表空间可以包含数个文件。</span></div><div><br/></div><div style="line-height: 14px; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline;"><span style="font-family: Arial;">          </span><img src="mysql优化_files/Image [1].png" type="image/png" height="319" style="cursor: default;cursor: default;" width="552"/></div><div style="line-height: 21px; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; font-weight: bold;">15.小心“永久链接”</span></div><div style="line-height: 21px; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><span style="font-family: 宋体; font-weight: bold;">16.</span><span style="text-indent: -0.56in; font-weight: bold; font-family: 宋体;">永远为每张表设置一个</span><span style="text-indent: -0.56in; font-weight: bold; font-family: Arial;">ID</span></div><div><span style="font-family: 宋体;"><br/></span></div><div><hr/></div><div><font face="宋体"><br/></font></div><div><font face="宋体"><br/></font></div><div><font face="宋体">在小型项目中可以用视图，但是大型项目数据量大的禁止用sql，因为视图是拼一个大的结果集，从中取数据。</font></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><font face="Arial"><b><br/></b></font></div><div style="line-height: 90%; margin-top: 6.72pt; margin-bottom: 0pt; margin-left: 0.56in; text-indent: -0.56in; text-align: left; direction: ltr; unicode-bidi: embed; vertical-align: baseline; font-size: 24px;"><font face="Arial"><b><br/></b></font></div></div>
</div></body></html> 